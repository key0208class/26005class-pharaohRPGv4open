<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥æ®¿è©¦ç…‰ v4.7.8.8 - å†’éšªæ¨¡å¼ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5e6c8; /* [å¯ä¿®æ”¹] èƒŒæ™¯åº•è‰² */
            /* èƒŒæ™¯ç´‹ç† */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23e6c677' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        /* 3D å¡ç‰‡ç¿»è½‰æ•ˆæœ (èˆŠæœ‰) èˆ‡ æ€ªç‰©å¡ç‰Œç‰¹æ•ˆ (æ–°å¢) */
        .pyramid-card { perspective: 1000px; width: 100%; height: 100%; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .card-back { transform: rotateY(180deg); }
        .flipped .card-inner { transform: rotateY(180deg); }

        /* [æ–°å¢] æ€ªç‰©å¡ç‰Œèˆå°èˆ‡ç‰¹æ•ˆ */
        .monster-stage { pointer-events: none; } /* è®“é»æ“Šç©¿é€ï¼Œä¸å½±éŸ¿ä¸‹æ–¹é‡‘å­—å¡” */
        .monster-slot { border: 2px dashed rgba(217, 119, 6, 0.3); background-color: rgba(255,255,255,0.1); border-radius: 0.5rem; }
        /* [æ–°å¢] æ€ªç‰©è¡€æ¢æ¨£å¼ */
        .monster-hp-wrap {
            position: absolute; bottom: 4px; left: 4px; right: 4px;
            height: 14px; background-color: rgba(0, 0, 0, 0.7);
            border-radius: 99px; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.5);
            z-index: 10; display: flex; align-items: center; justify-content: center;
        }
        .monster-hp-fill {
            position: absolute; top: 0; left: 0; height: 100%;
            background: linear-gradient(90deg, #ef4444, #dc2626); /* ç´…è‰²æ¼¸å±¤ */
            transition: width 0.3s ease; z-index: 1;
        }
        .monster-hp-text {
            position: relative; z-index: 2; font-size: 10px; font-weight: 900;
            color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,1); font-family: 'Courier New', monospace;
            line-height: 1; letter-spacing: 0.5px;
        }
        /* æ€ªç‰©å¡ç‰‡æœ¬é«”è¨­å®š */
        .monster-card-wrapper { perspective: 1000px; position: absolute; transition: all 1.5s cubic-bezier(0.25, 1, 0.5, 1); z-index: 30; pointer-events: auto; cursor: pointer; }
        .monster-card-inner { position: relative; width: 100%; height: 100%; text-align: center; transition: transform 0.8s; transform-style: preserve-3d; }
        .monster-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); overflow: hidden; border: 2px solid #fff; }
        .monster-face-front { background-color: #1a202c; transform: rotateY(180deg); } /* æ­£é¢(æ€ªç‰©åœ–) */
        .monster-face-back { background-color: #78350f; transform: rotateY(0deg); } /* èƒŒé¢(å¡èƒŒ) */
        
        /* ç‹€æ…‹ï¼šå·²ç¿»é–‹ (é¡¯ç¤ºæ€ªç‰©) */
        .monster-card-wrapper.is-flipped .monster-card-inner { transform: rotateY(180deg); }
        
        /* ç‹€æ…‹ï¼šå·²ç§»å‹•åˆ°å³å´ (æˆ°é¬¥ä½) - [v4.3.3] ä¿®æ­£å®šä½èˆ‡é™°å½± */
        .monster-card-wrapper.is-in-battle { 
            top: 0.5rem !important; 
            left: calc(100% - 6rem - 0.5rem) !important; /* æ‰‹æ©Ÿç‰ˆï¼šé å³å®šä½ */
            transform: scale(1.05); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
        }
        @media (min-width: 768px) {
            .monster-card-wrapper.is-in-battle {
                left: calc(100% - 7rem - 0.5rem) !important; /* é›»è…¦ç‰ˆï¼šé å³å®šä½ (å¡å¯¬7rem) */
            }
        }

        /* [å·²ä¿®æ”¹ v4.4] å‹•ç•«ï¼šæ”»æ“Šè¡åˆº - çªç ´é‚Šç•Œç‰ˆ */
        .monster-attacking { 
            /* æ™‚é–“å»¶é•·è‡³ 1.5s ä»¥ä¾¿å±•ç¤ºå®Œæ•´å‹•ä½œ */
            animation: attack-sequence 1.5s ease-in-out forwards; 
            z-index: 100; /* è¨­å®šæ¥µé«˜å±¤ç´šï¼Œç¢ºä¿é£›å‡ºæ¡†æ¡†æ™‚åœ¨æœ€ä¸Šå±¤ */
            position: relative; 
        }
        
        @keyframes attack-sequence { 
            0% { transform: translateX(0) scale(1); box-shadow: none; } 
            
            /* 30% é€€å¾Œï¼šå¤§å¹…å‘å·¦ç§»å‹•åˆ°æˆ°é¬¥å€å¤– (è² å€¼åŠ å¤§)ï¼Œç¸®å°è“„åŠ› */
            30% { transform: translateX(-150%) scale(0.9) rotate(-10deg); } 
            
            /* 50% è¡æ“Šï¼šå¤§å¹…å‘å³è¡åˆº (ç©¿éæˆ°é¬¥å€)ï¼Œæ”¾å¤§ä¸¦ç™¼å…‰ */
            50% { 
                transform: translateX(120%) scale(1.3) rotate(5deg); 
                box-shadow: 0 0 40px rgba(255, 0, 0, 1), 0 0 20px rgba(255, 100, 100, 0.9); 
                border-color: #ff3333 !important; 
            } 
            
            /* 80% åœé “ï¼šå±•ç¤ºæ”»æ“Šå§¿æ…‹ */
            80% { 
                transform: translateX(120%) scale(1.3) rotate(5deg); 
                box-shadow: 0 0 30px rgba(255, 0, 0, 0.9); 
            } 
            
            /* 100% è¿”å›ï¼šè¿…é€Ÿå›åˆ°åŸé» */
            100% { transform: translateX(0) scale(1); box-shadow: none; } 
        }

        .monster-damaged { animation: damage-flash 0.5s ease-in-out; }
        @keyframes damage-flash { 0%, 100% { filter: none; transform: scale(1.05); } 10%, 30%, 50%, 70%, 90% { transform: scale(1.05) translate(-2px, 0); } 20%, 40%, 60%, 80% { transform: scale(1.05) translate(2px, 0); } 50% { filter: sepia(1) saturate(5) hue-rotate(-50deg) brightness(1.2); } }
        
        /* éª°å­å‹•ç•« */
        .dice { transition: transform 0.5s ease-out; }
        .dice.rolling { animation: diceRoll 0.5s ease-in-out; }
        @keyframes diceRoll { 0%{transform:rotateX(0) rotateY(0) rotateZ(0)} 50%{transform:rotateX(720deg) rotateY(360deg) rotateZ(180deg)} 100%{transform:rotateX(0) rotateY(0) rotateZ(0)} }
        
        /* ç©å®¶ç•¶å‰ç‹€æ…‹èˆ‡å¡ç‰‡ç©ºä½ */
        .card-placeholder { border: 2px dashed #d4a85a; border-radius: 0.5rem; background-color: rgba(255,255,255,0.2); }
        .player-card { transition: all 0.3s ease; }
        .player-card:hover { transform: translateY(-3px); }
        .current-player { box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.5); border-color: #d97706; }
        
        /* äº’å‹•ç‹€æ…‹æ¨£å¼ */
        .selected-for-action { box-shadow: 0 0 15px 5px rgba(34, 197, 94, 0.7); border: 2px solid #16a34a; transform: scale(1.02); }
        .selected-card-ring { box-shadow: 0 0 0 4px #ef4444; transform: scale(1.05); z-index: 10; }
        
       /* v3.4.0 æ™‚ä¹‹æ²™ç‰¹æ•ˆ */
        .frozen-mode { filter: grayscale(100%) contrast(0.8); pointer-events: none; transition: filter 0.5s; }
        .frozen-timer-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 3rem; font-weight: 900; color: #3b82f6; /* è—è‰²ç²—é«” */
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 2px 2px 0 #1e3a8a;
            z-index: 50; white-space: nowrap; pointer-events: none;
            animation: pulse-blue 1s infinite;
        }
        .frozen-icon { font-size: 4rem; display: block; margin-bottom: -1rem; filter: drop-shadow(0 0 10px #60a5fa); }
        @keyframes pulse-blue { 0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; } }

        /* å€’æ•¸è¨ˆæ™‚ç·Šæ€¥ç‹€æ…‹å‹•ç•« (æ¼‚æµ® + æ”¾å¤§) */
        @keyframes urgentFloat { 0%, 100% { transform: translateY(0) scale(1.2); } 50% { transform: translateY(-5px) scale(1.3); } }
        .timer-urgent { animation: urgentFloat 1s ease-in-out infinite; color: #dc2626 !important; text-shadow: 2px 2px 0px #fff; }

        .edit-name-icon { cursor: pointer; user-select: none; margin-left: 8px; display: inline-block; opacity: 0.5; transition: opacity 0.2s; }
        .edit-name-icon:hover { opacity: 1; }
        
        .clickable-dice { cursor: pointer; transition: background-color 0.2s; }
        .clickable-dice:hover { background-color: #fceecb; transform: scale(1.05); }
        
        /* è¨Šæ¯çª—å¼·èª¿æ¨£å¼ */
        .message-highlight { color: #b45309; font-weight: 800; }
        
        /* Modal èƒŒæ™¯æ¨¡ç³Š */
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 50; }
        
        /* v3.0 æ–°å¢æ¨£å¼ */
        .role-card { transition: all 0.3s ease; cursor: pointer; border: 3px solid transparent; }
        .role-card:hover { transform: translateY(-5px); border-color: #d97706; background-color: #fffbeb; }
        
        /* å¹³æ¿å„ªåŒ–ä½ˆå±€ */
        .tablet-layout { display: flex; flex-direction: column; gap: 1rem; }
        @media (min-width: 1024px) {
            .tablet-layout { flex-direction: row; align-items: flex-start; }
            .tablet-left { width: 45%; flex-shrink: 0; }
            .tablet-right { width: 55%; flex-grow: 1; }
        }

        /* è¼¸å…¥æ¸¸æ¨™æ¨¡æ“¬ */
        .cursor-control-btn { touch-action: manipulation; }
        .cursor-control-btn:active { background-color: #d97706; transform: scale(0.95); }

        /* éš±è—åŸç”Ÿéµç›¤ä½†ä¿ç•™æ¸¸æ¨™ (é€é readonly é…åˆ JS) */
        .formula-input-readonly { caret-color: #d97706; cursor: text; }
        
        /* v3.2.9 æ–°å¢ï¼šè‡ªå‹•æ“²éª°é–‹é—œæ¨£å¼ */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; vertical-align: middle; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #d97706; }
        input:focus + .slider { box-shadow: 0 0 1px #d97706; }
        input:checked + .slider:before { transform: translateX(24px); }
        /* --- v4.0.1 æ–°å¢æ¨£å¼: å†’éšªå¤§å»³èˆ‡ç®¡ç†å“¡ --- */
        .lobby-card { background: rgba(255, 255, 255, 0.95); border-radius: 1.5rem; box-shadow: 0 10px 25px rgba(180, 83, 9, 0.2); border: 4px solid #d97706; transition: transform 0.3s; }
        .lobby-card:hover { transform: translateY(-5px); }
        .admin-gear { position: fixed; top: 1rem; right: 1rem; font-size: 1.5rem; cursor: pointer; z-index: 60; background: rgba(255,255,255,0.8); padding: 0.5rem; border-radius: 50%; border: 2px solid #b45309; transition: all 0.3s; }
        .admin-gear:hover { transform: rotate(90deg) scale(1.1); background: #fff; }
        .room-item { background: white; border: 2px solid #fcd34d; border-radius: 1rem; padding: 1rem; transition: all 0.2s; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .room-item:hover { border-color: #d97706; background: #fffbeb; transform: translateX(5px); }
        /* éš±è—ä¸æƒ³é¡¯ç¤ºçš„å…ƒç´ ä½†ä¿ç•™é‚è¼¯ */
        .hidden-logic { display: none !important; }
        /* ç™»å…¥éå ´ */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
/* --- v3.2.0 é“å…·ç³»çµ±æ¨£å¼ --- */
        .item-slot { position: relative; cursor: pointer; transition: all 0.2s; }
        .item-slot:hover { transform: scale(1.1); }
        .item-icon { font-size: 2rem; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); }
        .item-count { position: absolute; bottom: -5px; right: -5px; background: #dc2626; color: white; font-size: 0.7rem; font-weight: bold; width: 1.2rem; height: 1.2rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
        .item-active { animation: pulse-gold 1.5s infinite; filter: drop-shadow(0 0 5px #fbbf24); }
        @keyframes pulse-gold { 0% { transform: scale(1); } 50% { transform: scale(1.1); filter: drop-shadow(0 0 10px #fbbf24); } 100% { transform: scale(1); } }
        /* è€å¸«ç™¼æ”¾é“å…·æŒ‰éˆ• */
        .grant-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0.5rem; border-radius: 0.5rem; border: 2px solid #e5e7eb; transition: all 0.2s; }
        .grant-btn:hover { background-color: #fffbeb; border-color: #d97706; transform: translateY(-2px); }
        .grant-btn:active { transform: scale(0.95); }
        /* å­¸ç”Ÿçµ„åˆ¥æŒ‰éˆ• */
        .team-btn { transition: all 0.2s; }
        .team-btn.selected { ring: 4px; ring-color: #d97706; transform: scale(1.05); background-color: #fffbeb; }

        /* v3.0.5 æ–°å¢ï¼šæŒ‰éˆ•é–å®šç‹€æ…‹ */
        .btn-disabled { background-color: #9ca3af !important; background-image: none !important; cursor: not-allowed; transform: none !important; box-shadow: none !important; opacity: 0.7; }
        
        /* v3.0.5 æ–°å¢ï¼šåŠ å¤§é‡‘å­—å¡”æ•¸å­—èˆ‡é‚Šæ¡† */
        .pyramid-num-lg { font-size: 2.5rem; line-height: 1; } 
        @media (min-width: 768px) { .pyramid-num-lg { font-size: 3.5rem; } }

        /* v3.0.8 æ–°å¢æ¨£å¼ */
        /* 1. æ¨¡æ“¬è¼¸å…¥æ¡†èˆ‡æ¸¸æ¨™ */
        .fake-input-container {
            min-height: 3.5rem;
            display: flex; align-items: center; justify-content: center;
            background-color: #f8fafc; border: 2px solid #c7d2fe; border-radius: 0.5rem;
            font-size: 1.5rem; font-weight: 700; letter-spacing: 0.1em;
            overflow-x: auto; white-space: nowrap; cursor: text;
        }
        .cursor-blink {
            display: inline-block; width: 2px; height: 1.5em; background-color: #d97706;
            margin: 0 2px; vertical-align: middle;
            animation: blink-animation 1s step-end infinite;
        }
        @keyframes blink-animation { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* 2. æ”¾å¤§ç‰Œåº«å‰©é¤˜é¡¯ç¤º */
        .deck-count-box { font-size: 1.1rem; padding: 0.5rem; }
        .deck-count-num { font-size: 1.5rem; font-weight: 900; margin-left: 4px; }

       /* 3. è€å¸«ä»‹é¢æ“´å…… (ä¸‰æ¬„ä½ˆå±€) */
        /* [v4.1.4] åŠ å…¥ min-height è®“ä¸»æ§è€…å¯ä»¥çœ‹åˆ°æ›´é•·çš„åå–® */
        .teacher-panel-grid { display: grid; gap: 1rem; height: 100%; min-height: 240px; /* [å¯ä¿®æ”¹] èª¿æ•´æ­¤æ•¸å€¼å¯æ‹‰é•·åˆ—è¡¨é«˜åº¦ */ }
        @media (min-width: 1024px) {
            /* [å¯ä¿®æ”¹] åœ¨å¤§è¢å¹•ä¸‹ï¼Œå·¦é‚Š(æ§åˆ¶å°) 2frï¼Œå³é‚Š(å†’éšªå°éšŠ) 3fr -> è‹¥è¦æ›´å¯¬å¯æ”¹ç‚º 1.5fr 3.5fr */
            .teacher-panel-grid { grid-template-columns: 2fr 3fr; }
        }
        
        /* [æ–°å¢] å†’éšªå°éšŠåˆ—è¡¨å®¹å™¨æ¨£å¼ - æ§åˆ¶é¡¯ç¤ºé«˜åº¦ */
        /* height: 200px å¤§ç´„æ˜¯å¯ä»¥é¡¯ç¤º 3 äººçš„é«˜åº¦ï¼Œè¶…éæœƒå‡ºç¾å·è»¸ */
        .squad-board-container { 
            height: 170px; 
            overflow-y: auto;
            overflow-x: hidden; /* [v4.1.4] å¼·åˆ¶éš±è—æ©«å‘æ²è»¸ */
            background-color: rgba(255, 255, 255, 0.5); 
            border-radius: 0.75rem;
            border: 1px solid #fcd34d;
        }

        /* 4. å°çµ„è©³æƒ… Modal */
        .team-detail-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; }
        
        /* 5. å­¸ç”Ÿåˆ†æ•¸é¢æ¿ */
        .student-score-pill { background: #fffbeb; border: 2px solid #fcd34d; color: #92400e; padding: 4px 12px; border-radius: 999px; font-weight: bold; font-size: 0.9rem; display: inline-flex; items-center; gap: 4px; box-shadow: 0 2px 0 rgba(217,119,6,0.2); }
		/* v4.1.8 ç®¡ç†å“¡åˆ†é æ¨£å¼ */
        .admin-tab-btn { padding: 0.5rem 1rem; font-weight: bold; color: #64748b; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .admin-tab-btn:hover { color: #d97706; background-color: #fffbeb; border-radius: 0.5rem 0.5rem 0 0; }
        .admin-tab-active { color: #b45309; border-bottom-color: #b45309; }
        .admin-tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .admin-tab-content.active { display: block; }
		/* v3.0.9 æ–°å¢ï¼šé€šé—œç•«é¢èˆ‡æ’è¡Œæ¦œ */
        .game-over-modal-content {
            background: linear-gradient(135deg, #fffbeb 0%, #fff7ed 100%);
            border: 4px solid #b45309;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        
        .rank-badge { display: inline-flex; width: 2rem; height: 2rem; align-items: center; justify-content: center; border-radius: 50%; font-weight: 900; margin-right: 0.5rem; flex-shrink: 0; }
        .rank-1 { background: #fcd34d; color: #78350f; border: 2px solid #b45309; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .rank-2 { background: #e2e8f0; color: #475569; border: 2px solid #94a3b8; }
        .rank-3 { background: #ffedd5; color: #9a3412; border: 2px solid #c2410c; }
        .rank-other { background: #f3f4f6; color: #6b7280; font-size: 0.8rem; width: 1.5rem; height: 1.5rem; }
        
        .confetti-piece { position: absolute; width: 10px; height: 10px; background-color: #ffd700; animation: confetti-fall 3s linear infinite; }
        @keyframes confetti-fall { 0% { transform: translateY(-100%) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
/* æ€ªç‰©å—æ“Šéœ‡å‹•å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 0) rotate(-5deg); }
            20%, 40%, 60%, 80% { transform: translate(5px, 0) rotate(5deg); }
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
		/* [æ–°å¢] æ€ªç‰©æ­»äº¡ç ´ç¢ç‰¹æ•ˆ */
        .monster-die { animation: shatter-anim 2.5s forwards ease-in-out; pointer-events: none; }
        @keyframes shatter-anim {
            0% { transform: scale(1); filter: grayscale(0) brightness(1); opacity: 1; }
            10% { transform: scale(1.1) rotate(5deg); filter: grayscale(1) brightness(2) contrast(2); } /* è®Šäº®åƒµç›´ */
            30% { transform: scale(1.1) rotate(-5deg); filter: sepia(1) hue-rotate(-50deg) saturate(5); opacity: 0.9; } /* è®Šç´…/ç¢è£‚å‰å…† */
            100% { transform: scale(1.5) rotate(15deg); filter: blur(20px) brightness(0); opacity: 0; } /* ç ´ç¢æ·¡å‡º */
        }
		/* [æ–°å¢] å‚·å®³æ•¸å­—è·³å‡ºç‰¹æ•ˆ */
        .damage-text {
            position: absolute;
            left: 50%;
            top: 20%; /* [å¯ä¿®æ”¹] è‹¥è¦èª¿æ•´æ•¸å­—å‡ºç¾çš„é«˜ä½ï¼Œè«‹æ”¹é€™è£¡ (20% ç‚ºå¡ç‰‡ä¸Šæ–¹) */
            transform: translate(-50%, -50%);
            color: #ef4444; /* [å¯ä¿®æ”¹] æ•¸å­—é¡è‰² (ç›®å‰ç‚ºé®®ç´…è‰²) */
            font-size: 2.5rem; /* [å¯ä¿®æ”¹] æ•¸å­—å¤§å° (ç›®å‰ç‚º 2.5remï¼Œç›¸ç•¶å¤§) */
            font-weight: 900;
            text-shadow: 2px 2px 0px #fff, -1px -1px 0 #fff, 0 0 10px rgba(255,0,0,0.5); /* ç™½é‚Šèˆ‡ç™¼å…‰ */
            pointer-events: none;
            z-index: 100;
            font-family: 'Arial Black', sans-serif;
            animation: damage-float-up 1s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }
        @keyframes damage-float-up {
            0% { opacity: 0; transform: translate(-50%, 0) scale(0.5); }
            15% { opacity: 1; transform: translate(-50%, -30px) scale(1.5); } /* å½ˆå‡ºæ”¾å¤§ */
            100% { opacity: 0; transform: translate(-50%, -80px) scale(1); } /* å‘ä¸Šé£„èµ°æ¶ˆå¤± */
        }
		/* [æ–°å¢ v4.7.4] æ‡²ç½°é–ƒé›»ç‰¹æ•ˆ */
        .lightning-overlay {
            position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            background-image: url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E9%96%83%E9%9B%BB%E7%89%B9%E6%95%88.png');
            background-size: cover; background-position: center; background-repeat: no-repeat;
            opacity: 0;
        }
        .animate-lightning { animation: flash-lightning 0.4s ease-out; }
        @keyframes flash-lightning {
            0% { opacity: 0; filter: brightness(3); }
            10% { opacity: 1; filter: brightness(2); }
            30% { opacity: 0.5; }
            50% { opacity: 0.8; filter: invert(1); }
            100% { opacity: 0; }
        }
		/* [æ–°å¢ v4.7.4.1] çˆªç—•æ”»æ“Šç‰¹æ•ˆ */
        .claw-overlay {
            position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            background-image: url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E7%88%AA%E7%97%95.png');
            /* [å¯ä¿®æ”¹] çˆªç—•å¤§å°ï¼šä¿®æ”¹ä¸‹æ–¹çš„ 50% å³å¯æ”¹è®Šå¤§å° (åŸç‚º80%) */
            background-size: 30%; 
            background-position: center; background-repeat: no-repeat;
            opacity: 0; animation: claw-slash 0.5s ease-out forwards;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.8));
        }
        @keyframes claw-slash {
            0% { opacity: 0; transform: scale(1.5) rotate(-15deg); }
            20% { opacity: 1; transform: scale(1) rotate(0deg); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.1); }
        }

        /* [æ–°å¢ v4.7.0] ç©å®¶å—å‚·èˆ‡æ­»äº¡å¾©æ´»ç‰¹æ•ˆ */
        .player-damaged {
            animation: player-shake-red 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes player-shake-red {
            0%, 100% { transform: translateX(0); box-shadow: 0 0 0 rgba(220, 38, 38, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); box-shadow: 0 0 20px rgba(220, 38, 38, 0.8); border-color: #ef4444; }
            20%, 40%, 60%, 80% { transform: translateX(4px); box-shadow: 0 0 15px rgba(220, 38, 38, 0.6); }
        }
        
        .player-dead-overlay {
            position: absolute; inset: 0; background: rgba(50, 50, 50, 0.85);
            z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 0.5rem; backdrop-filter: blur(2px);
            color: #fff; font-weight: 900; text-align: center;
        }
        .revive-timer { font-size: 1.5rem; color: #fbbf24; text-shadow: 0 0 10px #d97706; animation: pulse 1s infinite; }
		        
        /* [ä¿®æ”¹ v4.7.6.10] é»‘å¸‚æ–‡å­—å„ªåŒ– (ç§»é™¤ CSS å‹•ç•«ï¼Œæ”¹ç”± JS æ§åˆ¶æ›è¡Œ) */
        .merchant-msg-box {
            white-space: pre-wrap;       /* ä¿ç•™æ›è¡Œç¬¦è™Ÿä¸¦è‡ªå‹•æ›è¡Œ */
            word-break: break-all;       /* é˜²æ­¢é•·å–®å­—ç ´ç‰ˆ */
            overflow-y: auto;            /* æ–‡å­—éå¤šæ™‚å¯æ»¾å‹• */
            max-height: 5rem;            /* é™åˆ¶æœ€å¤§é«˜åº¦ */
        }
        /* æ¸¸æ¨™é–ƒçˆæ•ˆæœ */
        .typing-cursor::after {
            content: '|';
            animation: blink-caret .75s step-end infinite;
            color: orange;
        }
        @keyframes blink-caret { from, to { opacity: 1; } 50% { opacity: 0; } }

        /* é»‘å¸‚æ²è»¸ç¾åŒ– */
        #bm-goods-list::-webkit-scrollbar { width: 6px; }
        #bm-goods-list::-webkit-scrollbar-track { background: #1a202c; }
        #bm-goods-list::-webkit-scrollbar-thumb { background: #78350f; border-radius: 3px; }
        #bm-goods-list::-webkit-scrollbar-thumb:hover { background: #b45309; }
</style>    
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body class="min-h-screen pb-12 text-slate-800">
    <div class="w-full px-4 py-8">
        <div class="text-center mb-6 relative">
            <h1 class="text-3xl md:text-5xl font-black text-amber-800 mb-2 drop-shadow-sm tracking-wide">ğŸº ç¥æ®¿è©¦ç…‰ v4.7.8.8 - å†’éšªæ¨¡å¼ç‰ˆ</h1>
            <p class="text-lg text-amber-700 font-medium">é€£ç·šç‰ˆ - å¤åŸƒåŠæ•¸å­¸è©¦ç…‰</p>
            <div id="connection-status" class="absolute top-0 right-0 text-xs font-mono text-gray-400">é€£ç·šä¸­...</div>
        </div>
        
        <div id="admin-gear-btn" class="admin-gear shadow-lg" onclick="app.openAdminAuth()" title="ç®¡ç†å“¡è¨­å®š">âš™ï¸</div>

        <div id="page-lobby" class="max-w-6xl mx-auto fade-in">
            <div class="grid md:grid-cols-12 gap-6">
                <div class="md:col-span-4 space-y-6">
                    <div class="lobby-card p-6 text-center relative overflow-hidden">
                       <div id="auth-panel-logged-in" class="hidden flex-col items-center animate-[fadeIn_0.5s_ease-out]">
                             <img id="user-avatar" src="" class="w-24 h-24 rounded-full border-4 border-amber-400 shadow-lg mb-4 object-cover" alt="Avatar">
                             <div class="text-sm text-gray-500 font-bold mb-1">æ­¡è¿å›ä¾†</div>
                             <div id="auth-name-display-area" class="flex items-center justify-center gap-2 mb-4 w-full">
                                 <h2 id="user-display-name" class="text-2xl font-black text-amber-900 truncate max-w-[200px]">å†’éšªè€…</h2>
                                 <button onclick="app.toggleEditName()" class="text-gray-400 hover:text-amber-600 p-1 rounded-full transition-colors" title="ä¿®æ”¹åç¨±">âœï¸</button>
                             </div>

                             <div id="auth-name-edit-area" class="hidden flex-col items-center gap-2 mb-4 w-full animate-[fadeIn_0.2s_ease-out]">
                                 <input type="text" id="edit-auth-name-input" class="w-full p-2 border-2 border-amber-300 rounded-lg text-center font-bold text-amber-900 placeholder-amber-200 focus:outline-none focus:border-amber-500" placeholder="è¼¸å…¥æ–°æš±ç¨±">
                                 <div class="flex gap-2 w-full justify-center">
                                      <button onclick="app.saveAuthName()" class="bg-green-500 text-white px-4 py-1 rounded-lg text-sm font-bold shadow hover:bg-green-600 active:scale-95 transition-transform">å„²å­˜</button>
                                      <button onclick="app.toggleEditName()" class="bg-gray-300 text-gray-700 px-4 py-1 rounded-lg text-sm font-bold hover:bg-gray-400 active:scale-95 transition-transform">å–æ¶ˆ</button>
                                 </div>
                             </div>

                             <!-- [æ–°å¢ v4.7.8.0] å¤§å»³ç¶“é©—æ¢èˆ‡è£å‚™å±•ç¤º -->
                             <div id="lobby-auth-stats-bar" class="w-full px-4 mb-3">
                                <div class="flex justify-between text-[0.6rem] font-bold text-amber-800/70 mb-0.5">
                                    <span>EXP</span>
                                    <span id="lobby-auth-exp-text">0/100</span>
                                </div>
                                <div class="w-full h-2 bg-amber-200/50 rounded-full overflow-hidden mb-2 border border-amber-300/30">
                                    <div id="lobby-auth-exp-fill" class="h-full bg-gradient-to-r from-amber-500 to-yellow-500 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <div id="lobby-auth-equip-list" class="flex justify-center gap-1 min-h-[1.5rem]">
                                    <!-- JS å‹•æ…‹ç”Ÿæˆè£å‚™å°åœ– -->
                                </div>
                             </div>
                             
                             <div class="grid grid-cols-2 gap-3 w-full mb-4">
                                 <div class="bg-amber-50 rounded-xl p-3 border border-amber-200 flex flex-col items-center justify-center">
                                     <div class="text-[0.65rem] text-amber-600 font-bold mb-1">æ­·å²æœ€é«˜åˆ†</div>
                                     <div class="text-2xl font-black text-amber-700 flex justify-center items-center gap-1">
                                         <span>ğŸ†</span>
                                         <span id="lobby-high-score-auth">0</span>
                                     </div>
                                 </div>
                                 <div class="bg-yellow-50 rounded-xl p-3 border border-yellow-200 flex flex-col items-center justify-center">
                                     <div class="text-[0.65rem] text-yellow-700 font-bold mb-1">å†’éšªé‡‘å¹£</div>
                                     <div class="text-2xl font-black text-yellow-800 flex justify-center items-center gap-1">
                                         <span>ğŸ’°</span>
                                         <span id="lobby-total-gold-auth">0</span>
                                     </div>
                                 </div>
                             </div>
                             
                             <button onclick="app.logout()" class="text-sm text-red-500 font-bold hover:text-red-700 hover:bg-red-50 px-4 py-2 rounded-full transition-colors mb-4">ç™»å‡º Google å¸³è™Ÿ</button>
                        </div>

                        <div id="auth-panel-guest" class="flex flex-col items-center">
                            <div class="text-6xl mb-4">ğŸ¤ </div>
                            <h2 class="text-2xl font-black text-amber-900 mb-2">å†’éšªè€…è³‡æ–™</h2>
                            <p class="text-xs text-gray-500 mb-4">ç™»å…¥ Google ä»¥é–‹å•Ÿå®Œæ•´åŠŸèƒ½(é‡‘å¹£é«”ç³»åŠè£å‚™é«”ç³»)</p>
                            
                            <button onclick="app.loginGoogle()" class="w-full bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl shadow-sm hover:bg-gray-50 hover:shadow-md transition-all active:scale-95 flex items-center justify-center gap-3 mb-4 group">
                                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-6 h-6" alt="G">
                                <span class="group-hover:text-blue-600 transition-colors">ä½¿ç”¨ Google ç™»å…¥</span>
                            </button>

                            <div class="relative w-full text-center border-t border-gray-200 my-2">
                                <span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-2 text-xs text-gray-400 font-bold">æˆ– åŒ¿åéŠç©</span>
                            </div>

                            <div class="w-full mt-4">
                                <label class="block text-amber-800 font-bold mb-2 text-left ml-1 text-sm">ä½ çš„æš±ç¨±</label>
                                <input type="text" id="lobby-player-name" class="w-full p-3 border-2 border-amber-300 rounded-xl text-center text-xl font-bold placeholder-amber-200 focus:outline-none focus:border-amber-500 transition-colors" placeholder="è¼¸å…¥æš±ç¨±...">
                            </div>

                            <div class="bg-amber-50 rounded-xl p-2 mt-4 border border-amber-200 w-full">
                                 <div class="text-xs text-amber-600 font-bold">æœ¬æ©Ÿç´€éŒ„ (æœªåŒæ­¥)</div>
                                 <div class="text-xl font-black text-amber-700" id="lobby-high-score">0</div>
                            </div>
                        </div>

                        <!-- [æ–°å¢ v4.7.7.4] è§’è‰²èƒŒåŒ…æŒ‰éˆ• -->
                        <div class="mt-4">
                            <button onclick="app.openCharacterBackpack()" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-bold py-3 rounded-xl shadow-md border-2 border-slate-600 hover:border-amber-500 hover:text-white transition-all active:scale-95 flex items-center justify-center gap-3 group relative overflow-hidden">
                                <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                                <span class="text-2xl filter drop-shadow">ğŸ’</span>
                                <span class="text-lg tracking-widest">è§’è‰²èƒŒåŒ…</span>
                            </button>
                        </div>

                        <hr class="border-amber-200 my-4">
                        
                        <button onclick="app.createRoom()" class="w-full bg-gradient-to-r from-amber-600 to-amber-800 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 text-xl mb-2 flex items-center justify-center gap-2">
                            <span>ğŸ°</span> å»ºç«‹æ–°æˆ¿é–“
                        </button>
                        <p class="text-xs text-gray-400">å»ºç«‹å¾Œå°‡è‡ªå‹•æˆç‚ºæˆ¿ä¸»</p>
                    </div>
                </div>

                <div class="md:col-span-8">
                    <div class="lobby-card p-6 min-h-[500px] flex flex-col">
                        <div class="flex flex-wrap justify-between items-center mb-6 border-b border-amber-200 pb-4 gap-2">
                            <div class="flex items-center gap-3">
                                <h2 class="text-2xl font-black text-amber-900">ğŸ—ºï¸ å†’éšªå¤§å»³</h2>
                               <!-- [ç§»è‡³æ­¤è™•] é»‘å¸‚æŒ‰éˆ• (é¢¨æ ¼èª¿æ•´ç‚ºç²¾ç·»æ¨™ç±¤) -->
                                <button id="btn-lobby-blackmarket" onclick="app.openBlackMarket()" class="flex items-center gap-1.5 bg-slate-800 text-amber-500 px-3 py-1 rounded-lg font-bold shadow-md hover:bg-black hover:text-amber-400 transition-all border border-slate-600 active:scale-95 group relative">
                                    <span class="text-lg filter drop-shadow group-hover:animate-bounce">ğŸ§›</span> 
                                    <span class="text-sm">é»‘å¸‚</span>
                                    <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
                                    <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                                </button>
                            </div>
                            <button onclick="app.refreshLobby()" class="text-amber-600 font-bold hover:text-amber-800 text-sm flex items-center gap-1 bg-white px-3 py-1 rounded-lg border border-amber-200 hover:bg-amber-50 transition-colors shadow-sm">
                                <span>ğŸ”„</span> <span class="hidden md:inline">é‡æ–°æ•´ç†</span>
                            </button>
                        </div>
                        
                        <div id="lobby-room-list" class="space-y-3 flex-1 overflow-y-auto pr-2">
                            <div class="text-center text-gray-400 py-10">
                                <div class="text-4xl mb-2">ğŸƒ</div>
                                <p>ç›®å‰æ²’æœ‰æ´»èºçš„å†’éšª...</p>
                                <p class="text-sm mt-2">ä½ å¯ä»¥å»ºç«‹ä¸€å€‹ï¼</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-auth-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center modal-backdrop">
            <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl border-4 border-slate-600 animate-[fadeIn_0.3s_ease-out]">
                <h3 class="text-xl font-black text-slate-800 mb-4 text-center">ğŸ›¡ï¸ ç®¡ç†å“¡é©—è­‰</h3>
                <input type="password" id="admin-password-input" class="w-full p-3 border-2 border-slate-300 rounded-xl text-center text-lg mb-4" placeholder="è«‹è¼¸å…¥é€šè¡Œå¯†ç¢¼">
                <div class="flex gap-2">
                    <button onclick="app.el('admin-auth-modal').classList.add('hidden')" class="flex-1 py-2 rounded-lg font-bold text-gray-500 hover:bg-gray-100">å–æ¶ˆ</button>
                    <button onclick="app.verifyAdmin()" class="flex-1 bg-slate-800 text-white py-2 rounded-lg font-bold shadow hover:bg-slate-900">ç¢ºèª</button>
                </div>
            </div>
        </div>

       <div id="admin-settings-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center modal-backdrop">
             <div class="bg-white rounded-2xl p-6 max-w-5xl w-full mx-4 shadow-2xl border-4 border-b-8 border-slate-700 animate-[fadeIn_0.3s_ease-out] max-h-[90vh] overflow-y-auto flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-2xl font-black text-slate-900">âš™ï¸ å…¨åŸŸéŠæˆ²è¨­å®š</h3>
                    <div class="flex items-center gap-3">
                        <button onclick="app.logoutAdmin()" class="bg-slate-200 text-slate-600 px-3 py-1 rounded-lg text-sm font-bold hover:bg-red-100 hover:text-red-600 transition-colors">ğŸ”’ ç™»å‡º</button>
                        <button onclick="app.el('admin-settings-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 font-bold text-xl px-2">âœ•</button>
                    </div>
                </div>

                <div class="flex border-b border-slate-200 mb-4 overflow-x-auto">
                    <button onclick="app.switchAdminTab('flow')" id="tab-btn-flow" class="admin-tab-btn admin-tab-active flex-1 whitespace-nowrap">ğŸ® éŠæˆ²æµç¨‹</button>
                    <button onclick="app.switchAdminTab('items')" id="tab-btn-items" class="admin-tab-btn flex-1 whitespace-nowrap">ğŸ é“å…·ç™¼æ”¾</button>
                    <button onclick="app.switchAdminTab('monsters')" id="tab-btn-monsters" class="admin-tab-btn flex-1 whitespace-nowrap">ğŸ‘¹ æ€ªç‰©è¨­å®š</button>
                    <button onclick="app.switchAdminTab('shop')" id="tab-btn-shop" class="admin-tab-btn flex-1 whitespace-nowrap">ğŸ›’ å†’éšªå•†åº—</button>
					<!-- [æ–°å¢ v4.7.6.0] é»‘å¸‚åˆ†é æŒ‰éˆ• -->
                    <button onclick="app.switchAdminTab('blackmarket')" id="tab-btn-blackmarket" class="admin-tab-btn flex-1 whitespace-nowrap">ğŸ§› é»‘å¸‚å•†å“</button>
                </div>
                
                <div class="space-y-6 flex-1 overflow-y-auto pr-1 custom-scrollbar">
                    
                    <div id="tab-content-flow" class="admin-tab-content active space-y-4">
                        
                        <!-- æ§åˆ¶ç¶²æ ¼ (è‡ªå‹•æ“²éª° / ç„¡ç›¡æ¨¡å¼ / ä¸‹ä¸€å±€æŒ‰éˆ• / é»‘å¸‚æŒ‰éˆ• / è£å‚™é™åˆ¶) -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- 1. è‡ªå‹•æ“²éª° -->
                            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 flex flex-col justify-between h-full">
                                <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">ğŸ² è‡ªå‹•æ“²éª°ç³»çµ±</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-600">é è¨­é–‹å•Ÿ (å„æˆ¿ä¸»å¯é—œ)</span>
                                    <label class="switch scale-90">
                                        <input type="checkbox" id="admin-auto-roll" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- 2. ç„¡ç›¡æ¨¡å¼ -->
                            <div class="bg-amber-50 p-4 rounded-xl border border-amber-200 flex flex-col justify-between h-full">
                                <h4 class="font-bold text-amber-800 mb-2 flex items-center gap-2">â™¾ï¸ ç„¡ç›¡æˆ°é¬¥æ¨¡å¼</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-amber-700">ç‰Œåº«å¾ªç’°ï¼ŒéŠæˆ²ä¸çµæŸ</span>
                                    <label class="switch scale-90">
                                        <input type="checkbox" id="admin-endless-mode">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- 3. ä¸‹ä¸€å±€æŒ‰éˆ• -->
                            <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-200 flex flex-col justify-between h-full">
                                <h4 class="font-bold text-emerald-800 mb-2 flex items-center gap-2">â­ï¸ ä¸‹ä¸€å±€æŒ‰éˆ•</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-emerald-700">é¡¯ç¤ºè€å¸«é¢æ¿æ›å±€éˆ•</span>
                                    <label class="switch scale-90">
                                        <input type="checkbox" id="admin-show-next-btn" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- 4. é»‘å¸‚æŒ‰éˆ• -->
                            <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200 flex flex-col justify-between h-full">
                                <h4 class="font-bold text-indigo-800 mb-2 flex items-center gap-2">ğŸ§› é»‘å¸‚å…¥å£</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-indigo-700">é¡¯ç¤ºå¤§å»³é»‘å¸‚æŒ‰éˆ•</span>
                                    <label class="switch scale-90">
                                        <input type="checkbox" id="admin-show-blackmarket" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- 5. è£å‚™æ¬„ä½é™åˆ¶ (æ–°å¢ v4.7.8.2) -->
                            <div class="bg-rose-50 p-4 rounded-xl border border-rose-200 flex flex-col justify-between h-full">
                                <h4 class="font-bold text-rose-800 mb-2 flex items-center gap-2">ğŸ’ è£å‚™æ¬„ä½ç­‰ç´šé™åˆ¶</h4>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-rose-700">é™åˆ¶é–‹å•Ÿ (é—œé–‰å‰‡å…¨å“¡å¯ç”¨)</span>
                                    <label class="switch scale-90">
                                        <input type="checkbox" id="admin-equip-limit" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- æ™‚é–“æ§åˆ¶è¨­å®š (å·²ä¿®å¾©å¤–æ¡†å®¹å™¨) -->
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-3 flex items-center gap-2">â±ï¸ æ™‚é–“æ§åˆ¶è¨­å®š</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">åŸºç¤å€’æ•¸ (ç§’)</label>
                                    <input type="number" id="admin-timer-base" value="120" class="w-full border-2 border-blue-300 rounded-lg p-2 text-center font-bold text-blue-900">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">ç­”å°é‡ç½® (ç§’)</label>
                                    <input type="number" id="admin-timer-reset" value="45" class="w-full border-2 border-blue-300 rounded-lg p-2 text-center font-bold text-blue-900">
                                </div>
                            </div>
                        </div>

                        <!-- æ€ªç‰©ç‰Œåº«åˆ†ä½ˆè¨­å®š -->
                        <div class="bg-stone-100 p-4 rounded-xl border border-stone-200">
                            <h4 class="font-bold text-stone-800 mb-3 flex items-center gap-2">ğŸƒ æ€ªç‰©ç‰Œåº«åˆ†ä½ˆè¨­å®š</h4>
                            <div class="text-xs text-gray-500 mb-2">è¨­å®šæ¯å±€éŠæˆ²è‡ªå‹•ç”¢ç”Ÿçš„æ€ªç‰©æ•¸é‡èˆ‡ç­‰ç´š (ç¸½æ•¸ç‚ºå„ç­‰ç´šä¹‹å’Œ)</div>
                            <div class="grid grid-cols-4 gap-2 md:grid-cols-7">
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.1 é»ƒåœŸ</label><input type="number" id="admin-md-1" value="2" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.2 é‹…éŠ…</label><input type="number" id="admin-md-2" value="1" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.3 ç™½éŠ€</label><input type="number" id="admin-md-3" value="1" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.4 é»ƒé‡‘</label><input type="number" id="admin-md-4" value="1" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.5 ç™½é‡‘</label><input type="number" id="admin-md-5" value="0" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.6 é»‘é‡‘</label><input type="number" id="admin-md-6" value="0" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                                <div><label class="block text-[0.6rem] font-bold text-stone-500">Lv.7 è—é‡‘</label><input type="number" id="admin-md-7" value="0" min="0" class="w-full border border-stone-300 rounded p-1 text-center font-bold"></div>
                            </div>
                        </div>

                        <!-- æ•¸æ“šæ¸…ç† -->
                        <div class="bg-red-50 p-4 rounded-xl border border-red-200">
                             <h4 class="font-bold text-red-800 mb-3">ğŸ—‘ï¸ æ•¸æ“šæ¸…ç†</h4>
                             <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-600">é–’ç½® 60 åˆ†é˜è‡ªå‹•æ¸…ç©º</span>
                                 <label class="switch">
                                    <input type="checkbox" checked disabled>
                                    <span class="slider"></span>
                                </label>
                             </div>
                             <button onclick="app.clearAllRooms()" class="w-full border-2 border-red-300 text-red-600 font-bold py-2 rounded-lg hover:bg-red-100 transition-colors">âš ï¸ å¼·åˆ¶æ¸…ç©ºæ‰€æœ‰æˆ¿é–“æ•¸æ“š</button>
                        </div>
                    </div>

                    <div id="tab-content-items" class="admin-tab-content space-y-4">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <h4 class="font-bold text-slate-800 mb-3 flex items-center gap-2">ğŸ è‡ªå‹•é“å…·åˆ†é…æ’ç¨‹ (GM)</h4>
                            
                            <div class="flex justify-between items-center mb-4 bg-white p-2 rounded-lg border">
                                <span class="text-sm font-bold text-slate-700">å•Ÿç”¨è‡ªå‹•ç™¼æ”¾</span>
                                <label class="switch">
                                    <input type="checkbox" id="admin-ag-enable">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="grid grid-cols-3 gap-2 mb-4">
                                 <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">é–“éš”å›åˆ</label>
                                    <input type="number" id="admin-ag-interval" value="3" class="w-full border-2 border-slate-300 rounded-lg p-2 text-center font-bold">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">çµ¦å€’æ•¸å¹¾å?</label>
                                    <input type="number" id="admin-ag-target" value="2" class="w-full border-2 border-slate-300 rounded-lg p-2 text-center font-bold">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-gray-500 mb-1">æ¯äººå¹¾å€‹?</label>
                                    <input type="number" id="admin-ag-count" value="1" class="w-full border-2 border-slate-300 rounded-lg p-2 text-center font-bold">
                                </div>
                            </div>

                            <div>
                                <label class="block text-base font-bold text-gray-600 mb-2">å…è¨±ç™¼æ”¾çš„é“å…· (GMæŒ‡å®š)</label>
                                <div class="grid grid-cols-2 gap-3 text-lg text-slate-800 bg-white p-3 rounded-xl border-2 border-slate-200">
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="hint" checked> <span>ğŸ“œ æç¤º</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="double" checked> <span>ğŸ¦‚ è–ç”²èŸ²</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="nile" checked> <span>ğŸŒŠ å°¼ç¾…æ²³</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="horus"> <span>ğŸ‘ï¸ è·é­¯æ–¯</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="time"> <span>â³ æ™‚ä¹‹æ²™</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="seal"> <span>ğŸ”’ å°å°</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="anubis"> <span>âš–ï¸ é˜¿åŠªæ¯”æ–¯</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="shard" checked> <span>ğŸ•’ ç¢ç‰‡</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="mummy"> <span>ğŸ‘» æœ¨ä¹ƒä¼Š</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="herb"> <span>ğŸŒ¿ è‰è—¥(+10)</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="potion"> <span>ğŸ§ª æ²»ç™‚åŠ‘(+20)</span></label>
                                    <label class="flex items-center gap-3 cursor-pointer hover:bg-amber-50 p-2 rounded-lg transition-colors select-none border border-transparent hover:border-amber-200"><input type="checkbox" class="admin-ag-item-check w-6 h-6 accent-amber-600" value="elixir"> <span>ğŸº è£œè¡€ç“¶(+30)</span></label>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
<div id="tab-content-monsters" class="admin-tab-content space-y-4">
                        
                        <div id="monster-list-view" class="block animate-[fadeIn_0.3s_ease-out]">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-stone-800 flex items-center gap-2 text-xl">ğŸ‘¹ æ€ªç‰©åœ–é‘‘ç¸½è¡¨</h4>
                                <button onclick="app.addNewMonster()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-green-700 active:scale-95 transition-transform flex items-center gap-2">
                                    <span>â•</span> æ–°å¢æ€ªç‰©
                                </button>
                            </div>
                            
                            <div class="bg-stone-100 rounded-xl border border-stone-300 overflow-hidden">
                                <div class="grid grid-cols-12 gap-2 bg-stone-200 p-3 font-bold text-stone-700 text-sm border-b border-stone-300 items-center text-center">
                                    <div class="col-span-1">é è¦½</div>
                                    <div class="col-span-1">åºè™Ÿ</div>
                                    <div class="col-span-3 text-left pl-2">åç¨± (é»æ“Šç·¨è¼¯)</div>
                                    <div class="col-span-1">å¡èƒŒ</div>
                                    <div class="col-span-1">HP</div>
                                    <div class="col-span-1">ATK</div>
                                    <div class="col-span-1 text-purple-700">ç¶“é©—</div>
                                    <div class="col-span-1">é‡‘å¹£</div>
                                    <div class="col-span-2">æ“ä½œ</div>
                                </div>
                                <div id="monster-list-container" class="max-h-[400px] overflow-y-auto custom-scrollbar bg-white">
                                    </div>
                            </div>
                            <div class="text-xs text-gray-500 mt-2 text-right">ğŸ’¡ æç¤ºï¼šç›´æ¥ä¿®æ”¹æ•¸å€¼å¾Œï¼Œè¨˜å¾—æŒ‰ä¸‹æœ€ä¸‹æ–¹çš„ã€Œå„²å­˜å…¨åŸŸè¨­å®šã€æ‰æœƒç”Ÿæ•ˆã€‚</div>
                        </div>

                        <div id="monster-editor-view" class="hidden animate-[fadeIn_0.3s_ease-out]">
                            <div class="flex justify-between items-center mb-4 bg-stone-100 p-3 rounded-xl border border-stone-200">
                                <button onclick="app.switchMonsterView('list')" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-600 active:scale-95 transition-transform flex items-center gap-2">
                                    <span>ğŸ”™</span> è¿”å›åˆ—è¡¨
                                </button>
                                <h4 class="font-bold text-stone-800 text-lg">ğŸ“ ç·¨è¼¯æ€ªç‰©è©³ç´°åƒæ•¸</h4>
                                <button onclick="app.deleteCurrentMonster()" class="bg-red-100 text-red-600 border border-red-300 px-4 py-2 rounded-lg font-bold hover:bg-red-200 active:scale-95 transition-transform">
                                    ğŸ—‘ï¸ åˆªé™¤æ­¤æ€ª
                                </button>
                            </div>

                            <div class="bg-stone-50 p-4 rounded-xl border border-stone-300">
                                <input type="hidden" id="edit-monster-index"> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <div class="space-y-2">
                                        <div>
                                            <label class="block text-xs font-bold text-gray-500 mb-1">æ€ªç‰©åç¨±</label>
                                           <input type="text" id="edit-monster-name" class="w-full border-2 border-stone-300 rounded-lg p-2 font-bold text-stone-900">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-bold text-gray-500 mb-1">å¡ç‰Œå¼·åº¦ (èƒŒå¡æ¨£å¼)</label>
                                            <select id="edit-monster-cardback" class="w-full border-2 border-blue-300 rounded-lg p-2 font-bold text-blue-900 bg-blue-50">
                                                <option value="1">Lv.1 é»ƒåœŸ</option>
                                                <option value="2">Lv.2 é‹…éŠ…</option>
                                                <option value="3">Lv.3 ç™½éŠ€</option>
                                                <option value="4">Lv.4 é»ƒé‡‘</option>
                                                <option value="5">Lv.5 ç™½é‡‘</option>
                                                <option value="6">Lv.6 é»‘é‡‘</option>
                                                <option value="7">Lv.7 è—é‡‘</option>
                                            </select>
                                        </div>

                                        <div class="grid grid-cols-4 gap-2">
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">HP</label>
                                                <input type="number" id="edit-monster-hp" class="w-full border-2 border-red-300 rounded-lg p-2 text-center font-bold text-red-700">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">ATK</label>
                                                <input type="number" id="edit-monster-atk" class="w-full border-2 border-orange-300 rounded-lg p-2 text-center font-bold text-orange-700">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1 text-purple-700">ç¶“é©—</label>
                                                <input type="number" id="edit-monster-exp" class="w-full border-2 border-purple-300 rounded-lg p-2 text-center font-bold text-purple-700">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">é‡‘å¹£</label>
                                                <input type="number" id="edit-monster-gold" class="w-full border-2 border-yellow-300 rounded-lg p-2 text-center font-bold text-yellow-700">
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-3 rounded-lg border border-stone-200 space-y-3 shadow-sm">
                                            <div class="text-xs font-bold text-stone-500 border-b pb-1 mb-1">âš”ï¸ æ”»æ“Šèˆ‡è¡Œç‚ºæ¨¡å¼</div>
                                            
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs font-bold text-stone-700">æ¨¡å¼1ï¼šè¢«å‹•åæ“Š (è¶…æ™‚/æœªè§£å®Œ)</span>
                                                <label class="switch scale-75"><input type="checkbox" id="edit-monster-mode-1"><span class="slider"></span></label>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs font-bold text-stone-700">æ¨¡å¼2ï¼šä¸»å‹•æ”»æ“Š (æ™‚é–“åˆ°å…¨é«”)</span>
                                                <label class="switch scale-75"><input type="checkbox" id="edit-monster-mode-2"><span class="slider"></span></label>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs font-bold text-stone-700">æ¨¡å¼3ï¼šæ‡²ç½°æ”»æ“Š (ç­”éŒ¯å–®é«”)</span>
                                                <label class="switch scale-75"><input type="checkbox" id="edit-monster-mode-3"><span class="slider"></span></label>
                                            </div>
                                            <div class="flex items-center gap-2 mt-1 border-t pt-2 border-stone-100">
                                                <span class="text-xs font-bold text-stone-700 whitespace-nowrap">æ¨¡å¼4ï¼šæ¯Nå›åˆå…¨é«”</span>
                                                <input type="number" id="edit-monster-mode-4-val" placeholder="0é—œé–‰" class="w-20 border rounded px-2 py-1 text-center text-sm font-bold bg-gray-50">
                                            </div>
                                            <div class="flex items-center gap-2 mt-1">
                                                <span class="text-xs font-bold text-stone-700 whitespace-nowrap">æ¨¡å¼5ï¼šæ³•å‰‡æ”»æ“Š(ç¦)</span>
                                                <select id="edit-monster-mode-5-op" class="w-full border rounded px-2 py-1 text-sm font-bold bg-white">
                                                    <option value="">ç„¡ (ä¸å•Ÿç”¨)</option>
                                                    <option value="+">ç¦ç”¨æ³•å‰‡ (+)</option>
                                                    <option value="-">ç¦ç”¨æ³•å‰‡ (-)</option>
                                                    <option value="Ã—">ç¦ç”¨æ³•å‰‡ (Ã—)</option>
                                                    <option value="Ã·">ç¦ç”¨æ³•å‰‡ (Ã·)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-3">
                                        <div class="bg-gray-800 rounded-lg h-48 flex items-center justify-center overflow-hidden border-4 border-stone-400 relative shadow-inner">
                                            <img id="edit-monster-preview-img" src="" class="max-h-full max-w-full object-contain" alt="é è¦½åœ–">
                                            <div class="absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs text-center p-1">å³æ™‚é è¦½</div>
                                        </div>
                                        
                                        <div class="bg-white p-3 rounded-lg border border-stone-200 space-y-2">
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">åœ–1 URL (æ­£å¸¸ç‹€æ…‹/åˆ—è¡¨åœ–)</label>
                                                <input type="text" id="edit-monster-img-1" oninput="document.getElementById('edit-monster-preview-img').src=this.value" class="w-full border border-stone-300 rounded p-1 text-xs font-mono text-gray-600">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">åœ–2 URL (æ”»æ“Šç‹€æ…‹)</label>
                                                <input type="text" id="edit-monster-img-2" class="w-full border border-stone-300 rounded p-1 text-xs font-mono text-gray-600">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">åœ–3 URL (BOSSåœ–)</label>
                                                <input type="text" id="edit-monster-img-3" class="w-full border border-stone-300 rounded p-1 text-xs font-mono text-gray-600">
                                            </div>
                                        </div>
                                        
                                        <button onclick="app.saveCurrentMonsterEdit()" class="w-full bg-amber-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-amber-700 active:scale-95 transition-all flex justify-center gap-2">
                                            <span>ğŸ’¾</span> æš«å­˜æ­¤æ€ªç‰©è¨­å®š
                                        </button>
                                        <p class="text-xs text-center text-gray-400">é»æ“Šæš«å­˜å¾Œï¼Œè¨˜å¾—åœ¨ä¸»ç•«é¢æŒ‰ä¸‹ã€Œå„²å­˜å…¨åŸŸè¨­å®šã€</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
<div id="tab-content-shop" class="admin-tab-content space-y-4">
                        <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200">
                            <h4 class="font-bold text-indigo-900 mb-3 flex items-center gap-2 text-lg">ğŸ›’ éŠæˆ²å•†åº—é“å…·å®šåƒ¹</h4>
                            <p class="text-xs text-indigo-700 mb-4">è¨­å®šå„é …é“å…·åœ¨å•†åº—ä¸­çš„å”®åƒ¹ã€è³¼è²·é–€æª»èˆ‡æŒæœ‰ä¸Šé™ã€‚</p>
                            
                            <div class="bg-white rounded-xl border border-indigo-100 overflow-hidden shadow-sm">
                                <div class="grid grid-cols-12 gap-1 bg-indigo-100 p-2 font-black text-indigo-800 text-xs text-center border-b border-indigo-200">
                                    <div class="col-span-4 text-left pl-2">é“å…·åç¨±</div>
                                    <div class="col-span-3">å”®åƒ¹(G)</div>
                                    <div class="col-span-2">é™Lv</div>
                                    <div class="col-span-3">ä¸Šé™(å€‹)</div>
                                </div>
                                <div class="max-h-[300px] overflow-y-auto custom-scrollbar p-1 space-y-1">
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="å¤è€æç¤ºå¡:æç¤ºé‹ç®—è¦å‰‡">ğŸ“œ æç¤ºå¡</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-hint-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="50"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-hint-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-hint-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="è–ç”²èŸ²ç¥ç¦:æ”»æ“ŠåŠ›x2">ğŸ¦‚ è–ç”²èŸ²</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-double-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="100"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-double-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-double-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="è·é­¯æ–¯ä¹‹çœ¼:å–ä»£1é¡†éª°å­ç‚º1~3é»">ğŸ‘ï¸ è·é­¯æ–¯</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-horus-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="150"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-horus-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-horus-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="å°¼ç¾…æ²³æ©è³œ:ç”¨2é¡†éª°å­é‹ç®—">ğŸŒŠ å°¼ç¾…æ²³</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-nile-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="150"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-nile-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-nile-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ™‚ä¹‹æ²™:æ™‚é–“æš«åœï¼ŒæŒçºŒæç¤ºä¸¦å°å°æ€ªç‰©æ”»æ“Š">â³ æ™‚ä¹‹æ²™</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-time-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="200"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-time-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-time-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ™‚ä¹‹ç¢ç‰‡:å»¶é•·æ™‚é–“30ç§’">ğŸ•’ ç¢ç‰‡</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-shard-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="80"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-shard-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-shard-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="2"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ³•è€ç‹çš„å°å°:å°å°é­”ç‰©è¡Œå‹•3å›åˆ">ğŸ”’ å°å°</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-seal-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="100"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-seal-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-seal-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="é˜¿åŠªæ¯”æ–¯çš„å¯©åˆ¤:é™å®šé‹ç®—ï¼Œé€šéå¾Œæ”»æ“ŠåŠ›x3">âš–ï¸ é˜¿åŠªæ¯”æ–¯</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-anubis-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="300"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-anubis-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="3"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-anubis-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æœ¨ä¹ƒä¼Šçš„è©›å’’:æ€ªç‰©è™›å¼±ï¼Œ2å›åˆæ‰€å—å‚·å®³æˆ1.5å€">ğŸ‘» æœ¨ä¹ƒä¼Š</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-mummy-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="250"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-mummy-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="2"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-mummy-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="1"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ¢å¾© 10 é»ç”Ÿå‘½">ğŸŒ¿ è‰è—¥</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-herb-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="50"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-herb-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="1"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-herb-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="5"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ¢å¾© 20 é»ç”Ÿå‘½">ğŸ§ª æ²»ç™‚åŠ‘</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-potion-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="100"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-potion-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="2"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-potion-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="3"></div>
                                    </div>
                                    <div class="grid grid-cols-12 gap-1 items-center p-2 hover:bg-indigo-50 rounded-lg transition-colors border-b border-gray-50">
                                        <div class="col-span-4 font-bold text-gray-700 text-sm truncate" title="æ¢å¾© 30 é»ç”Ÿå‘½">ğŸº è£œè¡€ç“¶</div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-elixir-price" class="w-full border border-gray-300 rounded px-1 text-center text-sm font-bold text-yellow-700 focus:bg-yellow-50 focus:border-yellow-400 outline-none" placeholder="200"></div>
                                        <div class="col-span-2"><input type="number" id="admin-shop-elixir-lv" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-blue-50 focus:border-blue-400 outline-none" placeholder="3"></div>
                                        <div class="col-span-3"><input type="number" id="admin-shop-elixir-limit" class="w-full border border-gray-300 rounded px-1 text-center text-sm text-gray-600 focus:bg-gray-50 outline-none" placeholder="2"></div>
                                    </div>
                                </div>
                           </div>
                        </div>
                    </div>

                    <!-- [æ–°å¢ v4.7.6.0] é»‘å¸‚å•†å“åˆ†é å…§å®¹ -->
                    <div id="tab-content-blackmarket" class="admin-tab-content space-y-4">
                        
                        <!-- é»‘å¸‚åˆ—è¡¨è¦–åœ– -->
                        <div id="blackmarket-list-view" class="block animate-[fadeIn_0.3s_ease-out]">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-bold text-slate-800 flex items-center gap-2 text-xl">ğŸ´â€â˜ ï¸ é»‘å¸‚å•†å“ç¸½è¡¨</h4>
                                <button onclick="app.addNewBlackMarketItem()" class="bg-slate-700 text-white px-4 py-2 rounded-lg font-bold shadow hover:bg-slate-800 active:scale-95 transition-transform flex items-center gap-2">
                                    <span>â•</span> æ–°å¢å•†å“
                                </button>
                            </div>
                            
                            <div class="bg-slate-100 rounded-xl border border-slate-300 overflow-hidden">
    <div class="grid grid-cols-12 gap-2 bg-slate-200 p-3 font-bold text-slate-700 text-sm border-b border-slate-300 items-center text-center">
        <div class="col-span-1">è²©å”®</div>
        <div class="col-span-1">é è¦½</div>
        <div class="col-span-1">åºè™Ÿ</div>
        <div class="col-span-2 text-left pl-2">åç¨± (é»æ“Šç·¨è¼¯)</div>
        <div class="col-span-1">åƒ¹æ ¼</div>
        <div class="col-span-1">æœ€é«˜LV</div>
        <div class="col-span-1">é£¾å“LV</div>
        <div class="col-span-1">é™è³¼LV</div>
        <div class="col-span-2">èªªæ˜ (ç•¶å‰LV)</div>
        <div class="col-span-1">æ“ä½œ</div>
    </div>
    <div id="blackmarket-list-container" class="max-h-[400px] overflow-y-auto custom-scrollbar bg-white"></div>
</div>
                        </div>

                        <!-- é»‘å¸‚è©³ç´°è¨­å®šè¦–åœ– -->
                        <div id="blackmarket-editor-view" class="hidden animate-[fadeIn_0.3s_ease-out]">
                            <div class="flex justify-between items-center mb-4 bg-slate-100 p-3 rounded-xl border border-slate-200">
                                <button onclick="app.switchBlackMarketView('list')" class="bg-gray-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-gray-600 active:scale-95 transition-transform flex items-center gap-2">
                                    <span>ğŸ”™</span> è¿”å›åˆ—è¡¨
                                </button>
                                <h4 class="font-bold text-slate-800 text-lg">ğŸ“ ç·¨è¼¯é»‘å¸‚å•†å“è©³ç´°åƒæ•¸</h4>
                                <button onclick="app.deleteCurrentBlackMarketItem()" class="bg-red-100 text-red-600 border border-red-300 px-4 py-2 rounded-lg font-bold hover:bg-red-200 active:scale-95 transition-transform">
                                    ğŸ—‘ï¸ åˆªé™¤å•†å“
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-4 rounded-xl border border-slate-300">
                                <!-- å·¦å´æ¬„ä½ -->
                                <div class="space-y-4">
                                    <input type="hidden" id="edit-bm-index">
                                    
                                    <div class="flex gap-4">
                                        <div class="flex-1">
                                            <label class="block text-xs font-bold text-gray-500 mb-1">å•†å“åç¨±</label>
                                            <input type="text" id="edit-bm-name" class="w-full border-2 border-slate-300 rounded-lg p-2 font-bold text-slate-900">
                                        </div>
                                        <div class="w-24">
                                            <label class="block text-xs font-bold text-gray-500 mb-2 text-center">æ˜¯å¦è²©å”®</label>
                                            <div class="flex justify-center">
                                                <label class="switch">
                                                    <input type="checkbox" id="edit-bm-is-sold">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs font-bold text-gray-500 mb-1">é£¾å“æœ€é«˜ç­‰ç´š</label>
                                            <input type="number" id="edit-bm-maxlv" onchange="app.renderBlackMarketLevelSelect()" class="w-full border-2 border-slate-300 rounded-lg p-2 text-center font-bold text-slate-900" min="1" max="10">
                                        </div>
                                        <div>
                                            <label class="block text-xs font-bold text-gray-500 mb-1">é£¾å“ç­‰ç´šè¨­å®š</label>
                                            <select id="edit-bm-level-select" onchange="app.loadBlackMarketLevelData()" class="w-full border-2 border-amber-300 rounded-lg p-2 font-bold text-amber-900 bg-amber-50 cursor-pointer">
                                                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
                                            </select>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-3 bg-amber-50 p-3 rounded-lg border border-amber-100">
                                        <div class="col-span-2 text-xs font-bold text-amber-600 mb-1 border-b border-amber-200 pb-1">ç•¶å‰é¸æ“‡ç­‰ç´š (LV<span id="display-bm-lv">1</span>) æ•¸å€¼</div>
                                        <div>
                                            <label class="block text-[0.65rem] font-bold text-gray-500 mb-1">åƒ¹æ ¼ (Gold)</label>
                                            <input type="number" id="edit-bm-price" class="w-full border border-slate-300 rounded p-1 text-center font-bold text-yellow-700">
                                        </div>
                                        <div>
                                            <label class="block text-[0.65rem] font-bold text-gray-500 mb-1">é™åˆ¶è³¼è²·ç­‰ç´š</label>
                                            <input type="number" id="edit-bm-minlv" class="w-full border border-slate-300 rounded p-1 text-center font-bold text-blue-700">
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-bold text-gray-500 mb-1">å•†å“èªªæ˜ <span class="text-red-500 text-[0.6rem]">(ä¸åŒç­‰ç´šå¯è¨­å®šä¸åŒèªªæ˜)</span></label>
                                        <textarea id="edit-bm-desc" class="w-full border-2 border-slate-300 rounded-lg p-2 font-bold text-gray-700 h-24 text-sm resize-none"></textarea>
                                    </div>
                                </div>

                                <!-- å³å´æ¬„ä½ -->
<div class="space-y-4">
    <div class="bg-slate-800 rounded-lg h-48 flex items-center justify-center overflow-hidden border-4 border-slate-600 relative shadow-inner group">
        <img id="edit-bm-preview-img" src="" class="max-h-full max-w-full object-contain" alt="é è¦½åœ–">
        <div class="absolute bottom-2 right-2 bg-black/70 text-amber-400 font-black text-xs px-2 py-1 rounded border border-amber-500/50" id="edit-bm-preview-tag">LV1</div>
        <div class="absolute top-0 left-0 bg-black/60 text-white text-[0.6rem] p-1 rounded-br">å³æ™‚é è¦½</div>
    </div>
    
    <!-- [ä¿®æ”¹] åœ–ç‰‡è¨­å®šæ”¹ç‚ºå‹•æ…‹ç”Ÿæˆå®¹å™¨ -->
    <div id="bm-image-setting-container" class="bg-slate-50 p-3 rounded-lg border border-slate-200 space-y-2 max-h-[300px] overflow-y-auto custom-scrollbar">
        <!-- JS å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <div class="flex gap-2">
        <button onclick="app.duplicateCurrentBlackMarketItem()" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-700 active:scale-95 transition-all flex justify-center gap-2">
            <span>ğŸ“‘</span> è¤‡è£½å•†å“
        </button>
        <button onclick="app.saveCurrentBlackMarketEdit()" class="flex-[2] bg-amber-600 text-white py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-amber-700 active:scale-95 transition-all flex justify-center gap-2">
            <span>ğŸ’¾</span> æš«å­˜è¨­å®š
        </button>
    </div>
</div>
                            </div>
                        </div>

                    </div>				
					
                <div class="mt-4 pt-4 border-t border-gray-100">
                    <button onclick="app.saveAdminSettings()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-slate-900 active:scale-95 transition-transform">ğŸ’¾ å„²å­˜å…¨åŸŸè¨­å®š</button>
                </div>
             </div>
        </div>
		<!-- [æ–°å¢ v4.7.7.4] è§’è‰²èƒŒåŒ…èˆ‡è£å‚™ç³»çµ± (RPG Style) -->
        <div id="character-backpack-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center modal-backdrop backdrop-blur-md">
            <!-- [v4.7.7.7 ä¿®æ”¹] ç¾Šçš®ç´™é¢¨æ ¼ä»‹é¢ -->
            <div class="bg-stone-900 rounded-3xl w-full max-w-6xl mx-4 shadow-2xl border-4 border-amber-700 flex flex-col md:flex-row overflow-hidden relative animate-[popIn_0.3s_ease-out]" style="height: 85vh;">
                
                <!-- å·¦å´ï¼šç´™å¨ƒå¨ƒè£å‚™å€ (ç¶­æŒæ·±è‰²èƒŒæ™¯ä»¥çªé¡¯è£å‚™) -->
                <div class="w-full md:w-6/12 bg-[url('https://www.transparenttextures.com/patterns/dark-leather.png')] bg-slate-900 border-b-4 md:border-b-0 md:border-r-4 border-amber-800 flex flex-col items-center justify-center relative p-0 overflow-hidden shadow-[inset_-10px_0_20px_rgba(0,0,0,0.5)]">
                    
                    <h3 class="absolute top-4 left-0 w-full text-center text-amber-500 font-black text-2xl tracking-widest drop-shadow-md z-10 pointer-events-none" style="text-shadow: 0 2px 4px rgba(0,0,0,0.8);">ğŸ›¡ï¸ å†’éšªè€…è£å‚™</h3>
                    
                    <!-- è£å‚™èƒŒæ™¯èˆ‡æ¬„ä½å®¹å™¨ -->
                    <div class="relative w-full h-full bg-no-repeat bg-center bg-cover" style="background-image: url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E6%96%B0%E4%BA%BA%E7%89%A9%E8%A3%9D%E5%82%99%E5%9C%962.png');">
                        
                        <!-- 6å€‹è£å‚™æ¬„ä½ (3å·¦ 3å³) -->
                        <div id="equip-slot-0" onclick="app.handleUnequipItem(0)" class="absolute top-[12%] left-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">HEAD</span>
                        </div>
                        <div id="equip-slot-2" onclick="app.handleUnequipItem(2)" class="absolute top-[42%] left-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">HAND</span>
                        </div>
                        <div id="equip-slot-4" onclick="app.handleUnequipItem(4)" class="absolute bottom-[15%] left-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">ACC1</span>
                        </div>
                        <div id="equip-slot-1" onclick="app.handleUnequipItem(1)" class="absolute top-[12%] right-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">BODY</span>
                        </div>
                        <div id="equip-slot-3" onclick="app.handleUnequipItem(3)" class="absolute top-[42%] right-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">OFF</span>
                        </div>
                        <div id="equip-slot-5" onclick="app.handleUnequipItem(5)" class="absolute bottom-[15%] right-[10%] w-[90px] h-[90px] bg-[url('https://class.kh.edu.tw/sites/30033/upload_file/6/%E8%A3%9D%E5%82%99%E6%A0%BC%E5%AD%90%E8%83%8C%E6%99%AF%E5%9C%96.png')] bg-contain bg-no-repeat bg-center flex items-center justify-center cursor-pointer transition-transform hover:scale-110 group filter drop-shadow-lg">
                            <span class="text-xs text-amber-200/50 font-bold group-hover:opacity-0 mt-8">ACC2</span>
                        </div>
                        
                        <div class="absolute bottom-2 left-0 w-full flex items-center justify-center pointer-events-none">
                            <div class="bg-black/60 text-amber-200 text-xs px-3 py-1 rounded-full backdrop-blur-sm border border-amber-500/30">é»æ“ŠèƒŒåŒ…ç‰©å“è£å‚™ / é»æ“Šæ¬„ä½å¸ä¸‹</div>
                        </div>
                    </div>
                </div>

                <!-- å³å´ï¼šç¾Šçš®ç´™é¢¨æ ¼è³‡æ–™èˆ‡èƒŒåŒ… -->
                <div class="w-full md:w-6/12 flex flex-col bg-[#f5e6c8] relative" style="background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');">
                    
                    <!-- é—œé–‰æŒ‰éˆ• (æ”¹ç‚ºæ–¹å½¢ï¼Œç§»è‡³å³ä¸Šè§’ï¼Œä¿®å¾©è¿”å›å¤§å»³é‚è¼¯) -->
                    <button onclick="app.el('character-backpack-modal').classList.add('hidden'); app.el('page-lobby').classList.remove('hidden');" class="absolute top-3 right-3 z-50 bg-red-800 text-white w-8 h-8 rounded-lg font-black shadow-lg hover:bg-red-700 hover:scale-105 active:scale-95 transition-all border-2 border-red-900 flex items-center justify-center" title="è¿”å›å¤§å»³">âœ•</button>

                    <!-- ä¸Šæ–¹ï¼šäººç‰©è³‡æ–™ (ç¾Šçš®ç´™é¢¨æ ¼) -->
                    <div class="p-6 border-b-4 border-amber-900/20 relative">
                        <div class="flex items-center gap-4 mb-3">
                            <!-- é ­åƒ -->
                            <div class="w-20 h-20 rounded-full border-4 border-amber-800 overflow-hidden shadow-lg bg-stone-300 flex-shrink-0">
                                <img id="bp-user-avatar" src="" class="w-full h-full object-cover">
                            </div>
                            
                            <!-- è³‡è¨Šå€ -->
                            <div class="flex-1 min-w-0 pr-8">
                                <h2 id="bp-user-name" class="text-2xl font-black text-amber-900 mb-1 truncate">å†’éšªè€…</h2>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-xs bg-amber-800 text-amber-100 px-2 py-0.5 rounded font-bold shadow-sm">LV.<span id="bp-user-lv">1</span></span>
                                    <span class="text-xs text-amber-800/70 font-bold">å†’éšªç­‰ç´š</span>
									<!-- [æ–°å¢ v4.7.8.0] èƒŒåŒ…æ¨™é ­è£å‚™é è¦½ -->
                                    <div id="bp-header-equip-list" class="flex gap-0.5 ml-2"></div>
                                </div>
                                
                                <!-- æ•¸æ“šé¡¯ç¤ºå€ (é‡‘å¹£å·¦ç§»ï¼ŒåŠ å…¥æœ€é«˜åˆ†) -->
                                <div class="flex flex-wrap gap-3">
                                    <div class="flex items-center gap-1 bg-yellow-200/50 px-2 py-1 rounded border border-yellow-600/30">
                                        <span class="text-sm">ğŸ’°</span>
                                        <div class="font-black text-amber-900 font-mono text-lg leading-none" id="bp-user-gold">0</div>
                                    </div>
                                    <div class="flex items-center gap-1 bg-amber-200/50 px-2 py-1 rounded border border-amber-600/30">
                                        <span class="text-sm">ğŸ†</span>
                                        <div class="font-black text-amber-900 font-mono text-lg leading-none" id="bp-user-highscore">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç¶“é©—å€¼æ¢ -->
                        <div class="w-full">
                            <div class="flex justify-between text-xs text-amber-900 mb-1 font-bold">
                                <span>EXP ç¶“é©—å€¼</span>
                                <span><span id="bp-exp-current">0</span> / <span id="bp-exp-next">100</span></span>
                            </div>
                            <div class="w-full h-3 bg-amber-900/20 rounded-full overflow-hidden border border-amber-900/30">
                                <div id="bp-exp-bar" class="h-full bg-gradient-to-r from-amber-600 to-yellow-600 transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                   <!-- ä¸‹æ–¹ï¼šèƒŒåŒ…ç‰©å“ (èª¿æ•´èƒŒæ™¯è‰²ä»¥é…åˆç¾Šçš®ç´™) -->
                    <div class="flex-1 flex flex-col overflow-hidden min-h-0 bg-amber-900/5 relative">
                        <div class="p-2 bg-amber-800/10 border-b border-amber-900/10 flex justify-between items-center z-10 shrink-0">
                            <span class="text-amber-900 font-bold flex items-center gap-2 text-sm ml-2">ğŸ’ ç‰©å“æ¬„ <span class="text-xs text-amber-800/60 font-normal">(é»æ“Šç‰©å“æŸ¥çœ‹è©³æƒ…)</span></span>
                            <span class="text-xs text-amber-800/50 mr-2">ä¾†è‡ªé»‘å¸‚çš„çè—</span>
                        </div>
                        
                        <!-- ç‰©å“ç¶²æ ¼ -->
                        <div id="bp-inventory-grid" class="flex-1 overflow-y-auto p-4 grid grid-cols-4 md:grid-cols-5 gap-3 content-start custom-scrollbar pb-32">
                            <!-- JS å‹•æ…‹ç”Ÿæˆ -->
                        </div>

                        <!-- [æ–°å¢] åº•éƒ¨é“å…·è©³æƒ…èˆ‡æ“ä½œé¢æ¿ -->
                        <div id="bp-item-action-panel" class="absolute bottom-0 left-0 w-full bg-[#f5e6c8] border-t-4 border-amber-800/20 p-3 shadow-[0_-5px_15px_rgba(0,0,0,0.1)] hidden flex-col animate-[slideUp_0.2s_ease-out] z-20" style="background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');">
                            <div class="flex gap-4">
                                <!-- é“å…·åœ–ç¤ºèˆ‡åç¨± -->
                                <div id="bp-panel-icon" class="w-16 h-16 rounded-lg border-2 border-amber-600/30 bg-amber-900/5 flex items-center justify-center shrink-0 shadow-inner"></div>
                                <div class="flex-1 min-w-0">
                                    <h4 id="bp-panel-name" class="font-black text-amber-900 text-lg truncate">é“å…·åç¨±</h4>
                                    <p id="bp-panel-desc" class="text-xs text-amber-800/80 font-bold leading-tight line-clamp-2 mt-1">é“å…·èªªæ˜</p>
                                </div>
                                <button onclick="app.closeBackpackPanel()" class="absolute top-2 right-2 text-amber-900/40 hover:text-amber-900 font-bold">âœ•</button>
                            </div>
                            <!-- æ“ä½œæŒ‰éˆ• -->
                            <div class="flex gap-3 mt-3">
                                <button id="btn-bp-equip" class="flex-1 bg-gradient-to-r from-amber-600 to-amber-700 text-white font-bold py-2 rounded-lg shadow-md active:scale-95 transition-transform flex justify-center items-center gap-2">
                                    <span>âš”ï¸</span> è£å‚™
                                </button>
                                <button onclick="app.closeBackpackPanel()" class="flex-1 bg-slate-500 text-white font-bold py-2 rounded-lg shadow-md hover:bg-slate-600 active:scale-95 transition-colors flex justify-center items-center gap-2">
                                    <span>âœ•</span> å–æ¶ˆ
                                </button>
                                <button id="btn-bp-discard" class="flex-1 bg-stone-300 text-stone-700 font-bold py-2 rounded-lg shadow-md hover:bg-stone-400 active:scale-95 transition-colors flex justify-center items-center gap-2">
                                    <span>ğŸ—‘ï¸</span> ä¸Ÿæ£„
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<!-- [æ–°å¢ v4.7.6.4] é»‘å¸‚ç³»çµ±ä»‹é¢ (Diablo é¢¨æ ¼) -->
        <div id="black-market-interface" class="hidden fixed inset-0 z-[60] bg-black text-slate-300 overflow-hidden font-mono animate-[fadeIn_0.5s_ease-out]">
            <!-- èƒŒæ™¯æè³ª -->
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')] opacity-30 pointer-events-none"></div>
            
            <div class="relative w-full h-full max-w-7xl mx-auto p-2 md:p-6 flex flex-col">
                <!-- é ‚éƒ¨å°è¦½åˆ— -->
                <div class="flex justify-between items-center border-b-2 border-slate-700 pb-4 mb-4 bg-black/50 backdrop-blur-sm z-20">
                    <h2 class="text-3xl md:text-4xl font-black text-red-700 tracking-widest drop-shadow-[0_0_10px_rgba(185,28,28,0.8)] flex items-center gap-3">
                        <span class="text-4xl">ğŸ§›</span> é»‘å¸‚ <span class="text-sm text-slate-500 font-bold tracking-normal hidden md:inline-block">å†’éšªç‰©å“é›†æ•£åœ°</span>
                    </h2>
                    <button onclick="app.closeBlackMarket()" class="group flex items-center gap-2 px-4 py-2 bg-slate-900 border border-slate-600 rounded hover:bg-red-900/50 hover:border-red-500 transition-all">
                        <span class="text-slate-400 group-hover:text-white font-bold">é›¢é–‹å¸‚å ´</span>
                        <span class="text-xl">ğŸšª</span>
                    </button>
                </div>

                <div class="flex-1 grid grid-cols-1 md:grid-cols-12 gap-6 overflow-hidden relative">
                    
                    <!-- å·¦å´ï¼šå•†äººèˆ‡å•†å“å€ (ä½”æ¯”è¼ƒå¤§) -->
                    <div class="md:col-span-8 flex flex-col gap-4 relative h-full overflow-hidden">
                        <!-- å•†äººå€åŸŸ (å›ºå®šé«˜åº¦ flex-none) -->
                        <div class="h-40 md:h-48 flex-none relative bg-slate-900/80 rounded-xl border border-slate-700 flex items-center p-4 shadow-[inset_0_0_30px_rgba(0,0,0,0.8)] overflow-visible">
                            <!-- [å¯ä¿®æ”¹] å•†äººåœ–ç‰‡å¤§å°èˆ‡ä½ç½® (çªç ´æ¡†æ¶) -->
                            <!-- è‹¥è¦èª¿æ•´åœ–ç‰‡å¤§å°ï¼Œè«‹ä¿®æ”¹ w-[180px] æˆ– scale æ•¸å€¼ -->
                            <img src="https://class.kh.edu.tw/sites/30033/upload_file/6/%E5%95%86%E4%BA%BA.png" class="absolute -top-6 -left-4 w-[140px] md:w-[220px] filter drop-shadow-[0_10px_20px_rgba(0,0,0,0.8)] z-10 hover:scale-105 transition-transform duration-500 pointer-events-none" alt="Merchant">
                            
                            <!-- å°è©±æ¡† -->
                            <div class="ml-[130px] md:ml-[210px] w-full pr-2">
                                <div class="bg-black/40 border border-slate-600 p-3 rounded-tl-2xl rounded-br-2xl relative min-h-[5rem] flex items-center">
                                    <div class="absolute -left-2 top-4 w-4 h-4 bg-slate-600 transform rotate-45"></div>
                                    <div class="absolute -left-2 top-4 w-4 h-4 bg-black transform rotate-45 translate-x-[1px]"></div>
                                    <p id="bm-merchant-msg" class="text-amber-500 font-bold text-sm md:text-base leading-relaxed merchant-msg-box typing-cursor w-full">
                                        æ­¡è¿ä¾†åˆ°é™°å½±ä¹‹åœ°ï¼Œå†’éšªè€…...
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- å•†å“åˆ—è¡¨å€ (ä½”æ»¿å‰©é¤˜ç©ºé–“ flex-1 min-h-0) -->
                        <div class="flex-1 min-h-0 bg-slate-900/90 rounded-xl border-2 border-slate-700 flex flex-col overflow-hidden shadow-2xl relative">
                            <div class="bg-gradient-to-r from-slate-800 to-black p-2 border-b border-slate-600 flex justify-between items-center z-10 flex-none">
                                <span class="text-slate-400 font-bold text-sm flex items-center gap-2">ğŸ“¦ è²©å”®æ¸…å–® <span class="text-xs text-slate-600">(ä¸å®šæœŸæ›´æ–°)</span></span>
                                <span class="text-xs text-amber-700 font-bold bg-black px-2 py-1 rounded border border-amber-900/30">è²¨ç‰©å”®å‡ºï¼Œæ¦‚ä¸é€€æ›</span>
                            </div>
                            <!-- [ä¿®æ”¹ v4.7.6.12] åŠ ä¸Š min-h-0 ç¢ºä¿ flex å­å…ƒç´ èƒ½æ­£ç¢ºè§¸ç™¼æ»¾å‹• -->
                            <div id="bm-goods-list" class="flex-1 flex flex-col overflow-hidden min-h-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')]">
                                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>

                    <!-- å³å´ï¼šå€‹äººè³‡è¨Šèˆ‡èƒŒåŒ… -->
                    <div class="md:col-span-4 flex flex-col gap-4 h-full overflow-hidden">
                        
                        <!-- å€‹äººè³‡è¨Šå¡ (å›ºå®šé«˜åº¦ flex-none) -->
                        <div class="flex-none bg-slate-800 rounded-xl p-4 border border-amber-900/50 shadow-lg relative overflow-hidden group">
                            <div class="absolute inset-0 bg-gradient-to-b from-amber-900/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                            
                            <div class="flex items-center gap-4 mb-4 border-b border-slate-600 pb-3">
                                <div class="w-16 h-16 rounded-full border-2 border-amber-600 bg-black overflow-hidden shadow-[0_0_15px_rgba(217,119,6,0.3)]">
                                    <img id="bm-user-avatar" src="" class="w-full h-full object-cover" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
                                </div>
                                <div>
                                    <div id="bm-user-name" class="text-lg font-black text-slate-200 truncate max-w-[150px]">å†’éšªè€…</div>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-xs bg-slate-900 text-amber-500 px-2 py-0.5 rounded border border-slate-600 font-bold">LV.<span id="bm-user-lv">1</span></span>
                                        <span class="text-[1rem] text-slate-500">å¸³æˆ¶ç­‰ç´š</span>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3">
                                <div class="bg-black/50 p-2 rounded border border-slate-700 text-center">
                                    <div class="text-[0.65rem] text-slate-400 mb-1">æŒæœ‰é‡‘å¹£</div>
                                    <div class="text-xl font-black text-amber-400 drop-shadow-sm flex justify-center items-center gap-1">
                                        <span class="text-sm">ğŸ’°</span> <span id="bm-user-gold">0</span>
                                    </div>
                                </div>
                                <div class="bg-black/50 p-2 rounded border border-slate-700 text-center">
                                    <div class="text-[0.65rem] text-slate-400 mb-1">é£¾å“ä»¶æ•¸</div>
                                    <div class="text-xl font-black text-slate-300 flex justify-center items-center gap-1">
                                        <span class="text-sm">ğŸ’</span> <span id="bm-inventory-count">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å¸³è™ŸèƒŒåŒ… (æ°¸ä¹…é“å…·) (ä½”æ»¿å‰©é¤˜ç©ºé–“ flex-1 min-h-0) -->
                        <div class="flex-1 min-h-0 bg-slate-800/80 rounded-xl border border-slate-600 flex flex-col overflow-hidden relative">
                            <div class="p-2 bg-slate-900/80 border-b border-slate-600 flex justify-between items-center flex-none">
                                <span class="font-bold text-slate-300 text-sm">ğŸ’ å†’éšªè€…èƒŒåŒ… (å¸³è™Ÿç¶å®š)</span>
                            </div>
                            
                            <!-- [ä¿®æ”¹ v4.7.6.12] åŠ ä¸Š min-h-0 ç¢ºä¿æ»¾å‹• -->
                            <div id="bm-inventory-grid" class="flex-1 overflow-y-auto min-h-0 p-3 grid grid-cols-4 gap-2 content-start custom-scrollbar">
                                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
                            </div>

                            <!-- é“å…·è©³æƒ…é è¦½å€ (é»æ“Šé“å…·å¾Œé¡¯ç¤º) -->
                            <div id="bm-item-detail-panel" class="h-32 bg-black border-t-2 border-slate-600 p-3 hidden flex-col justify-between animate-[fadeIn_0.2s_ease-out]">
                                <div class="flex gap-3">
                                    <div id="bm-detail-icon" class="text-3xl w-12 h-12 bg-slate-800 rounded flex items-center justify-center border border-slate-600 flex-shrink-0"></div>
                                    <div class="overflow-hidden">
                                        <div id="bm-detail-name" class="font-bold text-amber-500 text-sm truncate">é“å…·åç¨±</div>
                                        <div id="bm-detail-desc" class="text-xs text-slate-400 leading-tight mt-1 line-clamp-2">é“å…·èªªæ˜...</div>
                                    </div>
                                </div>
                                <div class="flex gap-2 mt-2">
                                    <button class="flex-1 bg-slate-700 text-slate-400 text-xs py-1 rounded cursor-not-allowed opacity-50" disabled>è£å‚™(é–‹ç™¼ä¸­)</button>
                                    <button class="flex-1 bg-red-900/50 text-red-400 text-xs py-1 rounded cursor-not-allowed opacity-50" disabled>è²©è³£(é–‹ç™¼ä¸­)</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div id="game-board" class="hidden fade-in">
            <div class="flex flex-wrap justify-between items-center mb-4 bg-white/80 backdrop-blur rounded-xl p-3 shadow border border-amber-200">
                <div class="flex items-center gap-3">
                    <span class="bg-amber-200 text-amber-900 px-3 py-1 rounded-full font-bold">ç­ç´š: <span id="display-class-id">--</span></span>
                    <span class="bg-blue-100 text-blue-900 px-3 py-1 rounded-full font-bold" id="user-identity">--</span>
                </div>
               <div class="flex items-center gap-3 mt-2 md:mt-0">
                    <div class="flex items-center gap-1">
                        <button id="voice-toggle-btn" class="hidden bg-gray-200 px-3 py-1 rounded-full text-sm font-bold hover:bg-gray-300 transition-colors" onclick="app.toggleVoice()">ğŸ”Š èªéŸ³é–‹</button>
                        <input id="voice-rate-input" type="number" min="0.5" max="3.0" step="0.1" value="1.5" class="hidden w-14 py-1 px-1 text-center text-sm font-bold border-2 border-amber-200 rounded-lg bg-white/80 focus:outline-none focus:border-amber-500" title="èªéŸ³é€Ÿåº¦ (0.5æ…¢ ~ 3.0å¿«)">
                    </div>
                    <button class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-bold border border-amber-200 hover:bg-amber-200 transition-colors" onclick="app.leaveGame()">ğŸ”™ è¿”å›å¤§å»³</button>
                </div>
            </div>

            <div class="tablet-layout">
                <div class="tablet-left flex flex-col gap-4">
                    <div class="bg-amber-100 rounded-2xl p-4 shadow-inner text-center relative border-2 border-amber-300">
                        <div id="round-display" class="absolute right-3 top-2 text-XL font-black text-amber-900/60 font-mono tracking-widest select-none">ROUND 1</div>
                        
                        <div id="game-status-text" class="text-xl font-bold text-amber-800">ç­‰å¾…éŠæˆ²é–‹å§‹...</div>
                        <div id="timer-display" class="hidden mt-2 text-4xl font-black text-red-600 font-mono drop-shadow-sm">30</div>
                    <!-- [æ–°å¢ v4.7.3] æˆ°åˆ©å“é¸æ“‡é¢æ¿ -->
                        <div id="reward-selection-panel" class="hidden mt-4 animate-[popIn_0.5s_ease-out]">
                            <div class="text-sm font-bold text-amber-900 mb-2 animate-bounce">ğŸ æˆ°é¬¥å‹åˆ©ï¼è«‹é¸æ“‡ä¸€é …æˆ°åˆ©å“ï¼š</div>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="app.handleRewardSelect(1)" class="flex flex-col items-center justify-center p-2 bg-gradient-to-b from-red-50 to-red-100 border-2 border-red-300 rounded-xl shadow-md hover:scale-105 active:scale-95 transition-transform group">
                                    <span class="text-2xl mb-1 filter drop-shadow-sm group-hover:scale-110 transition-transform">â¤ï¸</span>
                                    <span class="text-[0.65rem] font-black text-red-800 leading-tight">æœ€å¤§è¡€é‡<br>+5</span>
                                </button>
                                <button onclick="app.handleRewardSelect(2)" class="flex flex-col items-center justify-center p-2 bg-gradient-to-b from-yellow-50 to-yellow-100 border-2 border-yellow-300 rounded-xl shadow-md hover:scale-105 active:scale-95 transition-transform group">
                                    <span class="text-2xl mb-1 filter drop-shadow-sm group-hover:scale-110 transition-transform">ğŸ’°</span>
                                    <span class="text-[0.65rem] font-black text-yellow-800 leading-tight">éš¨æ©Ÿé‡‘å¹£<br>10~50</span>
                                </button>
                                <button onclick="app.handleRewardSelect(3)" class="flex flex-col items-center justify-center p-2 bg-gradient-to-b from-indigo-50 to-indigo-100 border-2 border-indigo-300 rounded-xl shadow-md hover:scale-105 active:scale-95 transition-transform group">
                                    <span class="text-2xl mb-1 filter drop-shadow-sm group-hover:scale-110 transition-transform">ğŸ›’</span>
                                    <span class="text-[0.65rem] font-black text-indigo-800 leading-tight">é€²å…¥<br>å•†åº—</span>
                                </button>
                            </div>
                        </div>
                    </div>
<div class="relative bg-amber-50/50 rounded-2xl p-4 min-h-[400px] flex flex-col items-center justify-center border-2 border-amber-200">
                        <!-- [ä¿®æ­£ä½ç½®] å†’éšªå•†åº—ä»‹é¢ (ç§»è‡³é‡‘å­—å¡”å€å¡Šå…§ï¼Œç¢ºä¿åªè¦†è“‹æ­¤å€) -->
                        <div id="ingame-shop-overlay" class="hidden absolute inset-0 z-[60] bg-slate-800/95 rounded-2xl flex flex-col overflow-hidden animate-[fadeIn_0.3s_ease-out] border-4 border-amber-500 shadow-2xl">
                            <!-- å•†åº—é ‚éƒ¨ -->
                            <div class="p-3 bg-gradient-to-r from-slate-900 to-slate-800 border-b border-amber-500/50 flex justify-between items-center shadow-lg shrink-0">
                                <h3 class="text-xl font-black text-amber-400 flex items-center gap-2 drop-shadow-md">ğŸ›’ <span class="hidden md:inline">å†’éšª</span>å•†åº—</h3>
                                <div class="flex items-center gap-2">
                                    <div class="bg-slate-900/50 px-3 py-1 rounded-full border border-slate-600 flex items-center gap-2 shadow-inner">
                                        <span class="text-yellow-400 font-bold text-sm">ğŸ’° <span id="shop-player-gold" class="font-mono text-lg">0</span></span>
                                    </div>
                                    <span class="text-slate-400 text-xs font-bold bg-slate-900 px-2 py-1 rounded border border-slate-700">Lv.<span id="shop-player-lv">1</span></span>
                                </div>
                            </div>
                            <!-- å•†å“åˆ—è¡¨ (æ»¾å‹•å€) -->
                            <div id="shop-items-grid" class="flex-1 overflow-y-auto p-2 grid grid-cols-2 gap-2 custom-scrollbar content-start bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] bg-fixed">
                               <!-- JS å‹•æ…‹ç”Ÿæˆå•†å“ -->
                            </div>
                            <!-- å•†åº—åº•éƒ¨ -->
                            <div class="p-3 bg-slate-900 border-t border-slate-700 text-center shrink-0">
                                <button onclick="app.closeInGameShop()" class="w-full bg-gradient-to-r from-red-600 to-red-800 hover:from-red-500 hover:to-red-700 text-white font-black py-3 px-6 rounded-xl shadow-lg transition-transform active:scale-95 border-b-4 border-red-900 active:border-b-0 active:translate-y-1 text-lg flex items-center justify-center gap-2">
                                    <span>ğŸšª</span> é›¢é–‹å•†åº— (ç¹¼çºŒå†’éšª)
                                </button>
                            </div>
                        </div>

                        <div id="monster-stage-layer" class="absolute inset-0 z-20 pointer-events-none rounded-2xl">
                            <div class="absolute top-2 left-2 w-24 h-40 md:w-28 md:h-48 monster-slot flex items-center justify-center opacity-50 transition-all">
                                <span class="text-xs font-bold text-amber-800 opacity-60">Deck</span>
                            </div>
                            <div class="absolute top-2 right-2 w-24 h-40 md:w-28 md:h-48 monster-slot flex items-center justify-center opacity-50 transition-all">
                                <span class="text-xs font-bold text-amber-800 opacity-60">Battle</span>
                            </div>
                            <div id="dynamic-monster-container"></div>
                        </div>
                        
                        <div id="pyramid-board" class="w-full max-w-[320px] mx-auto scale-90 origin-top">
                            </div>
                    </div>

                    <div class="grid grid-cols-4 gap-2 text-center font-bold text-white mt-2">
                        <div class="bg-black/80 rounded-lg deck-count-box">é»‘<div class="deck-count-num" id="count-black">0</div></div>
                        <div class="bg-red-600 rounded-lg deck-count-box">ç´…<div class="deck-count-num" id="count-red">0</div></div>
                        <div class="bg-blue-600 rounded-lg deck-count-box">è—<div class="deck-count-num" id="count-blue">0</div></div>
                        <div class="bg-yellow-400 text-black rounded-lg deck-count-box">é»ƒ<div class="deck-count-num" id="count-yellow">0</div></div>
                    </div>
                </div>

               <div class="tablet-right flex flex-col h-full">
                    
                   <div id="panel-teacher" class="hidden bg-white rounded-2xl p-4 shadow-lg border-2 border-amber-600 flex-shrink-0 overflow-hidden max-h-[40vh] transition-all">
                        <div class="teacher-panel-grid h-full">
                            
                            <div class="flex flex-col gap-2 h-full overflow-y-auto">
                                <div class="flex justify-between items-center mb-2 border-b pb-2 flex-shrink-0">
                                    <h3 class="text-1x1 font-bold text-amber-900">ğŸ›ï¸ ç¥æ®¿è©¦ç…‰</h3>
                                    <div class="flex items-center gap-2 bg-amber-50 px-3 py-1 rounded-full border border-amber-200">
                                        <span class="text-1x1 font-bold text-amber-900">ğŸ¤– æ“²éª°</span>
                                        <label class="switch scale-75">
                                            <input type="checkbox" id="auto-roll-toggle" onchange="app.toggleAutoRoll()">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-3 mb-2 flex-shrink-0">
                                    <button id="btn-roll" onclick="app.teacherRollDice()" class="col-span-2 bg-gradient-to-r from-amber-600 to-amber-700 text-white py-4 rounded-xl font-bold text-2xl shadow hover:scale-105 transition-transform active:scale-95">ğŸ² æ“²éª°å­</button>
                                    <button id="btn-teacher-next-round" onclick="app.forceNextRound()" class="bg-slate-600 text-white py-3 rounded-xl font-bold shadow hover:bg-slate-700 text-base active:scale-95">ä¸‹ä¸€å±€</button>
                                    <button onclick="app.triggerEndGame()" class="bg-red-700 text-white py-3 rounded-xl font-bold shadow hover:bg-red-800 text-base active:scale-95">ğŸ å†’éšªçµæŸ</button>
                                </div>
                                
                                
                            </div>

                            <div class="flex flex-col h-full overflow-hidden bg-amber-50/50 rounded-xl border border-amber-100 relative">
                                <div id="teacher-personal-board" class="overflow-y-auto flex-1 p-2 space-y-1 custom-scrollbar absolute inset-0">
                                </div>
                            </div>

                        </div>
                    </div>

                   <div id="panel-student" class="hidden flex flex-col h-full gap-3">
                        
                        <div id="student-squad-section" class="bg-white/80 rounded-xl p-2 border-2 border-amber-400 shadow-sm w-full">
                            <div class="flex justify-between items-center mb-1 border-b border-amber-200 pb-1">
                                <span class="font-black text-amber-800 text-base">âš”ï¸ å†’éšªå°éšŠç‹€æ³</span>
                                <span class="text-xs text-gray-500">é“å…·æŒæœ‰ä¸­</span>
                            </div>
                            <div id="student-team-board" class="squad-board-container custom-scrollbar" style="height: 160px;">
                                </div>
                        </div>

                        <div id="student-inventory" class="hidden flex items-center justify-between bg-amber-100/50 p-2 rounded-lg border border-amber-200 mx-2">
                            <span class="text-1xl font-black text-amber-900 mr-4 flex items-center shadow-sm bg-amber-200 px-2 rounded-lg">ğŸ’ èƒŒåŒ…</span>
                            <div id="inventory-list" class="flex gap-3 flex-1 justify-end"></div>
                        </div>

                        <div class="bg-white rounded-xl p-4 shadow border-2 border-amber-300">
                             <div class="flex justify-center gap-3 mb-3">
                                <button onclick="app.inputChar(app.state.dice.d8)" id="s-dice-8" class="cursor-control-btn w-12 h-12 bg-amber-100 border-2 border-amber-400 rounded-lg font-black text-xl hover:bg-amber-200 active:bg-amber-300 transition-colors">-</button>
                                <button onclick="app.inputChar(app.state.dice.d10)" id="s-dice-10" class="cursor-control-btn w-12 h-12 bg-amber-100 border-2 border-amber-400 rounded-lg font-black text-xl hover:bg-amber-200 active:bg-amber-300 transition-colors">-</button>
                                <button onclick="app.inputChar(app.state.dice.d12)" id="s-dice-12" class="cursor-control-btn w-12 h-12 bg-amber-100 border-2 border-amber-400 rounded-lg font-black text-xl hover:bg-amber-200 active:bg-amber-300 transition-colors">-</button>
                            </div>
                            
                            <div class="relative">
                                <div id="formula-display" class="fake-input-container" onclick="app.el('formula-display').focus()">
                                    <span class="text-gray-400 text-base font-normal">é»æ“ŠæŒ‰éˆ•è¼¸å…¥...</span>
                                </div>
                                <button onclick="app.backspace()" class="absolute right-2 top-2 bottom-2 px-3 text-red-500 hover:bg-red-50 rounded cursor-control-btn font-bold">âŒ«</button>
                            </div>
                        </div>
                            <div id="horus-input-area" class="hidden grid grid-cols-3 gap-2 mb-2 mt-2 animate-[fadeIn_0.3s_ease-out]"></div>
                        

                        <div id="active-item-status" class="hidden mb-2 p-3 rounded-lg border-2 border-amber-400 bg-amber-50 text-center animate-[popIn_0.3s_ease-out] cursor-pointer hover:bg-red-50 transition-colors" onclick="app.useItem(app.state.activeItem)" title="é»æ“Šå¯é—œé–‰é“å…·"></div>

                        <div class="grid grid-cols-4 gap-2 flex-grow">
                            <button id="btn-op-add" onclick="app.inputChar('+')" class="cursor-control-btn bg-indigo-100 text-indigo-900 rounded-lg font-bold text-2xl shadow border-b-4 border-indigo-200 transition-colors duration-300">+</button>
                            <button id="btn-op-sub" onclick="app.inputChar('-')" class="cursor-control-btn bg-indigo-100 text-indigo-900 rounded-lg font-bold text-2xl shadow border-b-4 border-indigo-200 transition-colors duration-300">-</button>
                            <button id="btn-op-mul" onclick="app.inputChar('Ã—')" class="cursor-control-btn bg-indigo-100 text-indigo-900 rounded-lg font-bold text-2xl shadow border-b-4 border-indigo-200 transition-colors duration-300">Ã—</button>
                            <button id="btn-op-div" onclick="app.inputChar('Ã·')" class="cursor-control-btn bg-indigo-100 text-indigo-900 rounded-lg font-bold text-2xl shadow border-b-4 border-indigo-200 transition-colors duration-300">Ã·</button>
                            
                            <button onclick="app.inputChar('(')" class="cursor-control-btn bg-indigo-50 text-indigo-800 rounded-lg font-bold text-xl shadow border-b-4 border-indigo-200 active:scale-95">(</button>
                            <button onclick="app.inputChar(')')" class="cursor-control-btn bg-indigo-50 text-indigo-800 rounded-lg font-bold text-xl shadow border-b-4 border-indigo-200 active:scale-95">)</button>
                            <button onclick="app.moveCursor(-1)" class="cursor-control-btn bg-amber-200 text-amber-900 rounded-lg font-black text-2xl shadow border-b-4 border-amber-300 active:scale-95 active:bg-amber-300">â¬…ï¸</button>
                            <button onclick="app.moveCursor(1)" class="cursor-control-btn bg-amber-200 text-amber-900 rounded-lg font-black text-2xl shadow border-b-4 border-amber-300 active:scale-95 active:bg-amber-300">â¡ï¸</button>
                            <button onclick="app.submitAnswer()" id="btn-submit" class="col-span-4 bg-green-600 text-white rounded-xl font-bold text-xl shadow-lg border-b-4 border-green-800 active:scale-95 active:border-b-0 transition-all mt-2 py-3 disabled:opacity-50 disabled:grayscale">âœ¨ é©—è­‰ç­”æ¡ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="msg-toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 transition-opacity opacity-0 pointer-events-none font-bold text-lg text-center w-max max-w-[90%]">
                æç¤ºè¨Šæ¯
            </div>
        </div>
       <div id="game-over-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center modal-backdrop">
             <div class="game-over-modal-content bg-white rounded-3xl p-6 md:p-8 max-w-4xl w-full mx-4 relative overflow-hidden flex flex-col max-h-[90vh]">
                <div class="text-center mb-4 z-10">
                    <div class="text-6xl mb-2 animate-bounce">ğŸ‰</div>
                    <h2 class="text-3xl md:text-4xl font-black text-amber-800 drop-shadow-sm">å†’éšªå®Œæˆï¼</h2>
                    
                    <!-- çµç®—æˆ°ç¸¾å„€è¡¨æ¿å®¹å™¨ -->
<div id="end-game-summary-container" class="mt-2 w-full">
    <!-- JS å°‡å‹•æ…‹ç”Ÿæˆè©³ç´°æˆ°ç¸¾ (é‡‘å¹£/ç¶“é©—/æ™‚é–“/BOSSåœ–) -->
</div>
                </div>
                
                <div class="flex-1 overflow-y-auto z-10 px-1 py-2 custom-scrollbar">
                    <div class="bg-amber-50/50 rounded-xl p-4 border border-amber-200">
                        <h3 class="font-bold text-amber-900 border-b-2 border-amber-200 pb-2 mb-3 text-center text-lg flex justify-center items-center gap-2">
                            <span>ğŸ†</span> å‚³å¥‡å†’éšªå®¶
                        </h3>
                        <div id="end-player-ranks" class="space-y-2">
                            </div>
                    </div>
                </div>

                <div class="mt-4 text-center z-10 pt-4 border-t border-amber-100">

                <div class="mt-6 text-center z-10 pt-4 border-t border-amber-100">
                    <p class="text-sm text-gray-500 mb-3">éšŠé•·ç¢ºèªå¾Œå¯é–‹å•Ÿæ–°çš„ä¸€å±€</p>
                    <div class="flex flex-col md:flex-row justify-center gap-3">
                        <button onclick="app.leaveGame()" class="bg-slate-500 text-white px-6 py-3 rounded-full font-bold text-lg shadow-lg hover:bg-slate-600 transition-transform">ğŸ”™ è¿”å›å¤§å»³</button>
                        <button id="btn-download-report" onclick="app.downloadGameData()" class="hidden bg-green-600 text-white px-6 py-3 rounded-full font-bold text-lg shadow-lg hover:bg-green-700 transition-transform">ğŸ“¥ ä¸‹è¼‰æˆ°ç¸¾è¡¨</button>
                        <button id="btn-restart-game" onclick="(async () => { try { await app.resetGame(); } catch(e) { console.error(e); } })()" class="hidden bg-gradient-to-r from-amber-600 to-amber-800 text-white px-8 py-3 rounded-full font-bold text-xl shadow-lg hover:scale-105 transition-transform">ğŸ”„ é–‹å•Ÿæ–°å†’éšª</button>
                    </div>
                    <button id="btn-close-end-modal" onclick="app.el('game-over-modal').classList.add('hidden')" class="md:hidden mt-2 text-gray-400 underline text-sm">æš«æ™‚é—œé–‰</button>
                </div>
             </div>
        </div>
<div id="auto-grant-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center modal-backdrop">
             <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl border-4 border-amber-600 animate-[fadeIn_0.3s_ease-out]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-black text-amber-900">âš™ï¸ è‡ªå‹•é“å…·æ’ç¨‹</h3>
                    <button onclick="app.el('auto-grant-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 font-bold text-xl">âœ•</button>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between items-center bg-amber-50 p-3 rounded-xl border border-amber-200">
                        <span class="font-bold text-amber-900">å•Ÿç”¨è‡ªå‹•ç™¼æ”¾</span>
                        <label class="switch">
                            <input type="checkbox" id="ag-enable">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">æ¯éš”å¹¾å›åˆ?</label>
                            <input type="number" id="ag-interval" value="3" min="1" class="w-full border-2 border-amber-300 rounded-lg p-2 text-center font-bold text-amber-900">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">çµ¦å€’æ•¸å¹¾çµ„?</label>
                            <input type="number" id="ag-target-count" value="2" min="1" max="5" class="w-full border-2 border-amber-300 rounded-lg p-2 text-center font-bold text-amber-900">
                        </div>
                         <div class="col-span-2">
                            <label class="block text-xs font-bold text-gray-500 mb-1">æ¯çµ„çµ¦å¹¾å€‹?</label>
                            <input type="number" id="ag-item-count" value="1" min="1" max="3" class="w-full border-2 border-amber-300 rounded-lg p-2 text-center font-bold text-amber-900">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-2">å…è¨±ç™¼æ”¾çš„é“å…· (éš¨æ©ŸæŠ½å–)</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="hint" checked> ğŸ“œ æç¤º</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="double" checked> ğŸ¦‚ è–ç”²èŸ²</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="nile" checked> ğŸŒŠ å°¼ç¾…æ²³</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="horus"> ğŸ‘ï¸ è·é­¯æ–¯</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="time"> â³ æ™‚ä¹‹æ²™</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="seal"> ğŸ”’ å°å°</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="anubis"> âš–ï¸ é˜¿åŠªæ¯”æ–¯</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="shard" checked> ğŸ•’ ç¢ç‰‡</label>
							<label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="mummy"> ğŸ‘» æœ¨ä¹ƒä¼Š</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="herb"> ğŸŒ¿ è‰è—¥</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="potion"> ğŸ§ª æ²»ç™‚åŠ‘</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="checkbox" class="ag-item-check" value="elixir"> ğŸº è£œè¡€ç“¶</label>
                        </div>
                    </div>
                </div>

                <button onclick="app.saveAutoGrantSettings()" class="w-full bg-green-600 text-white rounded-xl font-bold py-3 shadow-lg hover:bg-green-700 active:scale-95 transition-all">âœ… å„²å­˜ä¸¦å¥—ç”¨</button>
             </div>
        </div>
        <div id="team-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center modal-backdrop" onclick="if(event.target === this) this.classList.add('hidden')">
             <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl border-4 border-amber-600 animate-[fadeIn_0.3s_ease-out]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-black text-amber-900" id="modal-team-title">å°çµ„è©³æƒ…</h3>
                    <button onclick="document.getElementById('team-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 font-bold text-xl">âœ•</button>
                </div>
                <div id="modal-team-list" class="space-y-2 max-h-[300px] overflow-y-auto">
                    </div>
             </div>
        </div>
		<div id="student-stats-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center modal-backdrop" onclick="if(event.target === this) this.classList.add('hidden')">
             <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl border-4 border-amber-600 animate-[fadeIn_0.3s_ease-out] flex flex-col max-h-[80vh]">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-xl font-black text-amber-900">ğŸ“Š å†’éšªæˆ°æ³é€Ÿå ±</h3>
                    <button onclick="document.getElementById('student-stats-modal').classList.add('hidden')" class="text-gray-400 hover:text-gray-600 font-bold text-xl">âœ•</button>
                </div>
                <div id="student-stats-content" class="overflow-y-auto space-y-4 p-1">
                    </div>
             </div>
        </div>
        <div id="solution-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center modal-backdrop">
             <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl border-4 border-amber-600 text-center animate-[urgentFloat_0.5s_ease-out]">
                <h3 class="text-2xl font-black text-amber-900 mb-4">ğŸ”® æ³•è€ç‹çš„æç¤º</h3>
                <div class="bg-amber-100 p-4 rounded-xl mb-4">
                    <p class="text-sm text-amber-800 mb-1">å‰å…©å€‹æ•¸å­—çš„é‹ç®—æ˜¯...</p>
                    <p id="solution-hint-text" class="text-3xl font-bold text-indigo-700 font-mono tracking-wider">--</p>
                </div>
                <button onclick="document.getElementById('solution-modal').classList.add('hidden')" class="bg-amber-700 text-white px-6 py-2 rounded-lg font-bold">æˆ‘çŸ¥é“äº†</button>
             </div>
        </div>
<div id="reset-overlay" class="fixed inset-0 z-[70] hidden flex flex-col items-center justify-center bg-slate-900/95 text-white animate-[fadeIn_0.5s_ease-out]">
            <div class="text-6xl mb-6 animate-bounce">ğŸº</div>
            <h2 class="text-3xl md:text-5xl font-black mb-4 text-amber-400 tracking-widest">å†’éšªå·²é‡ç½®</h2>
            <p class="text-xl text-gray-300 mb-12">æ³•è€ç‹å·²é–‹å•Ÿæ–°çš„ç¯‡ç« </p>
            <button onclick="app.leaveGame()" class="group relative px-8 py-4 bg-transparent overflow-hidden rounded-full transition-all hover:scale-105">
                <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-amber-500 to-amber-700 opacity-90 group-hover:opacity-100 transition-opacity"></div>
                <div class="relative flex items-center gap-3">
                    <span class="text-2xl font-bold text-white shadow-sm">ğŸ”™ å›åˆ°åˆå§‹ä¹‹åœ°</span>
                </div>
            </button>
        </div>
    </div>
<script src="game.js"></script>
</body>
</html>
</body>
</html>